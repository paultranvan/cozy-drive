!function(e){function t(t){for(var r,i,c=t[0],u=t[1],s=t[2],p=0,f=[];p<c.length;p++)i=c[p],o[i]&&f.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);f.length;)f.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={1:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var l=u;a.push([5,0]),n()}({0:function(e,t){},"0yyf":function(e,t,n){e.exports={"pho-sidebar":"pho-sidebar--1JZDr","pho-content":"pho-content--6vy4r","pho-content-wrapper":"pho-content-wrapper--1u34M",spin:"spin--OsM9y",shake:"shake--V0phk"}},1:function(e,t){},"1BUi":function(e,t,n){e.exports={"recipient-status":"recipient-status--2uFD7","recipient-menu-btn":"recipient-menu-btn--2_GX0",recipient:"recipient--HkJgC","recipients-list-light":"recipients-list-light--3bHel","recipient-avatar":"recipient-avatar--1Cmmp","recipient-avatar--small":"recipient-avatar--small--2hoPQ","recipient-avatar-link":"recipient-avatar-link--3gLdE","recipient-avatar-plusx":"recipient-avatar-plusx--2ruV6","recipient-idents":"recipient-idents--3NhkH","recipient-ident-status":"recipient-ident-status--3W1WI","recipient-user":"recipient-user--2ON6I","recipient-details":"recipient-details--tV3VQ",avatar:"avatar--2xuqM","recipients-avatars":"recipients-avatars--1PuFV","--interactive":"_--interactive--3t-An","recipient-owner":"recipient-owner--3PukF","recipient-menu":"recipient-menu--Gn7vM","action-unshare":"action-unshare--W0mml","action-unshare-desc":"action-unshare-desc--8flsy",spin:"spin--2Hvw_",shake:"shake--KwEfF"}},2:function(e,t){},"2OO4":function(e){e.exports={Nav:{photos:"Photos",albums:"Albums",shared:"Shared by me",trash:"Trash","btn-client":"Get Cozy Drive for desktop","btn-client-web":"Get Cozy","btn-client-mobile":"Get Cozy Drive on your mobile!","banner-txt-client":"Get Cozy Drive for Desktop and synchronise your files safely to make them accessible at all times.","banner-btn-client":"Download","link-client":"https://cozy.io/en/download/","link-client-desktop":"https://nuts.cozycloud.cc/download/channel/stable/","link-client-android":"https://play.google.com/store/apps/details?id=io.cozy.drive.mobile","link-client-ios":"https://itunes.apple.com/us/app/cozy-drive/id1224102389?mt=8","link-client-web":"https://cozy.io/fr/try-it?from=albumsharing"},empty:{timeline_photos_title:"You don't have any photos yet.",timeline_photos_text:'Click the "Upload" button to add photos.',albums_title:"You don't have any album yet.",albums_text:'Start by clicking "New album" to create your first album.',album_photos_title:"There is no photo in this album yet.",album_photos_text:'Start by clicking "Add photos to album" to add some.',shared_album_photos_title:"There is no photo in this album yet.",shared_album_photos_text:"Come back later"},Error:{albums_title:"An error occurred while retrieving the albums list. Please try again later.",album_photos_title:"An error occurred while retrieving the album's photos list. Please try again later.",timeline_photos_title:"An error occurred while retrieving the photos list. Please try again later.",public_album_error_title:"An error occurred while retrieving the photos list. Please try again later.",public_album_unshared_title:"Sorry, this link is no longer available.",public_album_unshared_text:"One lost, ten found... or just check out with the owner for help. This file might not be lost.",refresh:"Refresh now",generic:"An error occurred, please try again.",album_rename_abort:"The album name can not be empty."},Toolbar:{photo_upload:"Upload",album_new:"New album",album_delete:"Delete",album_quit:"Leave & delete shared album",album_download:"Download",more:"More",menu:{select_items:"Select photos",photo_upload:"Upload photos",rename_album:"Rename album",album_delete:"Delete album",album_quit:"Leave & delete shared album",download_album:"Download album",add_photos:"Add photos to album"}},loading:{photos_indexing:"Your photos are currently being indexed. Please wait.",albums_indexing:"Your albums are currently being indexed. Please wait.",photos_fetching:"Loading",albums_fetching:"Loading",photos_upload:"Uploading"},Board:{load_more:"Load more photos",select_all:"Select all",unselect_all:"Unselect all"},Alerter:{photos:{fetching_error:"An error occurred during photos fetching.",already_added_photo:"This album already contains this photo."}},SelectionBar:{selected_count:"item selected |||| items selected",delete:"Delete","album-add":"Add to album","album-remove":"Remove from album",download:"Download",close:"Close"},Share:{status:{pending:"Pending",accepted:"Accepted",refused:"Refused",error:"Error",unregistered:"Error","mail-not-sent":"Error",revoked:"Error"},type:{"one-way":"Can View (coming soon)","two-way":"Can Change"},"create-cozy":"Create my cozy"},Albums:{album_item_description:"%{smart_count} photo |||| %{smart_count} photos",album_item_shared_ro:"Shared (read only)",album_item_shared_rw:"Shared (read/write)",load_more:"Load more albums",add_photos:{title:"Add to album",success:"Album %{name} has been updated with %{smart_count} photo. |||| Album %{name} has been updated with %{smart_count} photos.",error:{generic:"An error occurred when updating the album, please try again.",reference:"Some photos has not been added to the album. Please check and try again.",response:{Forbidden:"Application does not have permission to update albums."}}},share:{cta:"Share",title:"Share with others",details:{title:"Sharing details",createdAt:"On %{date}",ro:"Read only",rw:"Read/write"},sharedByMe:"Shared",sharedWithMe:"Shared with me",shareByLink:{subtitle:"By public link",desc:"Anyone with the provided link can see and download your photos.",fetchFailed:"Woops! It seems your connectivity is limited, try again later when it gets better.",creating:"Creating your link...",copy:"Copy link",copied:"Link has been copied to clipboard",failed:"Unable to copy to clipboard"},shareByEmail:{title:"By email",subtitle:"By email",email:"email",emailPlaceholder:"Enter the email address or name of the recipient",send:"Send",genericSuccess:"You sent an invite to %{count} contacts.",success:"You sent an invite to %{email}.",comingsoon:"Coming soon! You will be able to share documents and photos in a single click with your family, your friends, and even your coworkers. Don't worry, we'll let you know when it's ready!"},unshare:{title:"Remove from album",success:"You removed this shared album from %{email}."},sharingLink:{title:"Link to share",copy:"Copy",copied:"Copied"},whoHasAccess:{title:"Who has access"},protectedShare:{title:"Coming soon!",desc:"Share anything by email with your family and friends!"},close:"Close",gettingLink:"Getting your link...",error:{generic:"An error occurred when creating the album share link, please try again.",revoke:"An error occurred when revoking the album share link, please try again."}},create:{panel_form:{label:"Add a name to your new album",placeholder:"Untitled album",cancel:"Cancel",submit:"Create new album",update:"Add photos to album"},inline_form:{placeholder:"New album name",create_label:"Create a new album",create_button:"Create"},success:"Album %{name} has been created with %{smart_count} photo. |||| Album %{name} has been created with %{smart_count} photos.",error:{generic:"An error occurred when creating the album, please try again.",already_exists:"The album %{name} already exists, please pick another one.",name_missing:"You have to give a name to your album."}},fetchAlbums:{error:{index_missing:"An albums index must be provided to fetch albums."}},remove_photos:{success:"The photo has been removed from album %{album_name}",error:{generic:"An error occured while removing the photo, please try again."}},remove_album:{success:"Album %{name} was deleted.",error:{generic:"An error occured while removing the album, please try again."}},quit_album:{success:"Album %{name} was deleted.",error:{generic:"An error occured while leaving the album, please try again."}}},Viewer:{close:"Close",noviewer:{title:"The viewer doesn't know how to read this type of file yet.",download:"Download this file",openWith:"Open with..."},actions:{download:"Download"},loading:{error:"This file could not be loaded. Do you have a working internet connection right now?",retry:"Retry"}},destroyconfirmation:{title:"Permanently delete this album?",cancel:"Cancel",delete:"Delete permanently",forbidden:"You won't be able to access this album or selection anymore.",eye:"Your photos won't be deleted.",link:"If you have shared it, people won't be able to access it."},quitconfirmation:{title:"Permanently leave and delete this shared album?",cancel:"Cancel",quit:"Leave & delete",forbidden:"You won't be able to access this album or selection anymore."},timeline:{DeleteConfirm:{title:"Delete this element? |||| Delete these elements?",trash:"It will be moved to the Trash. |||| They will be moved to the Trash.",restore:"You can still restore it whenever you want. |||| You can still restore them whenever you want.",shared:"If you have shared it, people won't be able to access it. |||| If you have shared them, people won't be able to access them.",related:"Some of the photos within the selection are related to an album. They will be removed from it if you proceed to trash them.",cancel:"Cancel",delete:"Remove"}},UploadQueue:{path_photos:"Photos",path_upload:"Uploaded from Cozy Photos",header:"Uploading %{smart_count} photo to Cozy Photos |||| Uploading %{smart_count} photos to Cozy Photos",header_mobile:"Uploading %{done} of %{total}",header_done:"Uploaded %{done} out of %{total} successfully",close:"close",item:{pending:"Pending"},alert:{success:"%{smart_count} photo uploaded with success. |||| %{smart_count} photos uploaded with success.",success_conflicts:"%{smart_count} photo uploaded with %{conflictNumber} conflict(s). |||| %{smart_count} photos uploaded with %{conflictNumber} conflict(s).",errors:"Errors occurred during the photos upload."}}}},"2lpW":function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("SH7X"),u=n("buk/"),s=n("17x9"),l=n.n(s),p=n("0yyf"),f=n.n(p),d=n("jDpt"),m=n("eKCf"),h=n("t0Aa"),b=n.n(h),y=n("TSYQ"),v=n.n(y),g=n("zzwF"),w=n("y6ex"),_=n("asgm");var O=function(e){var t,n,r,o=e.label,a=e.inMenu,c=e.disabled,u=e.onUpload,s=e.className;return i.a.createElement(_.a,{accept:"image/*",className:v()(s,(t={},n="".concat(b.a["c-btn"]),r=!a,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t)),"data-test-id":"upload-btn",disabled:c,multiple:!0,onChange:u,value:[]},i.a.createElement("span",null,!a&&i.a.createElement(w.a,{icon:"upload"}),i.a.createElement("span",null,o)))};O.propTypes={label:l.a.string.isRequired,disabled:l.a.bool,inMenu:l.a.bool,onUpload:l.a.func.isRequired,className:l.a.string.isRequired},O.defaultProps={disabled:!1,inMenu:!1};var E=O,k=n("SvPG"),j=n("DbnX"),S=function(e){var t=e.t,n=e.disabled,r=e.uploadPhotos,o=e.selectItems;return i.a.createElement(g.b,{disabled:n,position:"right",className:b.a["pho-toolbar-menu"],component:i.a.createElement(k.b,null)},i.a.createElement(g.a,{icon:i.a.createElement(w.a,{icon:"upload"}),className:b.a["u-hide--desk"]},i.a.createElement(E,{onUpload:r,disabled:n,label:t("Toolbar.menu.photo_upload"),inMenu:!0,className:v()(b.a["u-hide--tablet"],b.a["pho-action-upload"])})),i.a.createElement("hr",{className:b.a["u-hide--desk"]}),i.a.createElement(g.a,{onSelect:o,icon:i.a.createElement(w.a,{icon:j.a})},t("Toolbar.menu.select_items")))};S.propTypes={disabled:l.a.bool,uploadPhotos:l.a.func.isRequired,selectItems:l.a.func.isRequired,t:l.a.func.isRequired};var x=function(e){var t=e.t,n=e.disabled,r=void 0!==n&&n,o=e.uploadPhotos,a=e.selectItems;return i.a.createElement("div",{className:b.a["pho-toolbar"],role:"toolbar"},i.a.createElement(E,{className:b.a["u-hide--mob"],onUpload:o,disabled:r,label:t("Toolbar.photo_upload")}),i.a.createElement(S,{t:t,disabled:r,uploadPhotos:o,selectItems:a}))};x.propTypes={disabled:l.a.bool,uploadPhotos:l.a.func.isRequired,selectItems:l.a.func.isRequired,t:l.a.func.isRequired};var P=x,C=n("2sk9"),A=n.n(C),T=n("cLsY"),R=function(e){var t=e.t,n=e.count,r=e.confirm,o=e.abort,a=["trash","restore","shared"];!0===e.related&&a.push("related");var c=a.map(function(e){return i.a.createElement("p",{className:v()(A.a["fil-confirm-text"],A.a["icon-".concat(e)]),key:"key_delet_".concat(e)},t("timeline.DeleteConfirm.".concat(e),n))});return i.a.createElement(T.c,{title:t("timeline.DeleteConfirm.title",n),description:c,secondaryType:"secondary",secondaryText:t("timeline.DeleteConfirm.cancel"),secondaryAction:o,primaryType:"danger",primaryText:t("timeline.DeleteConfirm.delete"),primaryAction:r})},N=n("5wWc"),z=n("TtgU"),L=n("KHOr"),D=n("SRpc"),q=n("q/Uw"),I=n("z6Q1");function M(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function B(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){M(a,r,o,i,c,"next",e)}function c(e){M(a,r,o,i,c,"throw",e)}i(void 0)})}}var F="".concat(I.b,"/photos"),U="".concat(I.b,"/photos/upload"),G=("".concat(I.b,"/photos/mobile"),function(){var e=B(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(I.c).findReferencedBy({_type:I.b,_id:n});case 2:return r=e.sent,a=r.included,e.abrupt("return",a.filter(function(e){return!1===/^\/\.cozy_trash/.test(e.attributes.path)}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),V=function(){var e=B(o.a.mark(function e(t,n,r){var a,i,c,u,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t,r);case 2:if(!(a=e.sent).length){e.next=7;break}return e.abrupt("return",a[0]);case 7:return i=t.collection(I.c),e.next=10,i.ensureDirectoryExists(n);case 10:return c=e.sent,e.next=13,i.addReferencesTo({_id:r,_type:I.b},[{_id:c}]);case 13:return e.next=15,i.get(c);case 15:return u=e.sent,s=u.data,e.abrupt("return",s);case 18:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){X(e,t,n[t])})}return e}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function $(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){J(a,r,o,i,c,"next",e)}function c(e){J(a,r,o,i,c,"throw",e)}i(void 0)})}}var ee=function(){var e=$(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t,U);case 2:if(!((r=e.sent).length>0)){e.next=7;break}return e.abrupt("return",r[0]._id);case 7:return e.next=9,V(t,"/".concat(n("UploadQueue.path_photos")),F);case 9:return e.next=11,V(t,"/".concat(n("UploadQueue.path_photos"),"/").concat(n("UploadQueue.path_upload")),U);case 11:return a=e.sent,e.abrupt("return",a._id);case 13:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),te=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,u=new Array(c),s=0;s<c;s++)u[s]=arguments[s];return r=this,a=(e=W(t)).call.apply(e,[this].concat(u)),n=!a||"object"!==H(a)&&"function"!=typeof a?Z(r):a,X(Z(n),"state",{showAddAlbumModal:!1}),X(Z(n),"showAddAlbumModal",function(){n.setState(function(e){return Y({},e,{showAddAlbumModal:!0})})}),X(Z(n),"hideAddAlbumModal",function(){n.setState(function(e){return Y({},e,{showAddAlbumModal:!1})})}),X(Z(n),"uploadPhotos",function(){var e=$(o.a.mark(function e(t){var r,a,i,c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.uploadPhoto,a=n.context,i=a.client,c=a.t,e.next=4,ee(i,c);case 4:u=e.sent,n.dispatch(Object(L.b)(t,function(e){return r(e,u)}));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X(Z(n),"downloadPhotos",function(e){n.context.client.collection("io.cozy.files").downloadArchive(e.map(function(e){return e._id}),"selected")}),X(Z(n),"deletePhotos",function(e,t){return Object(N.a)(i.a.createElement(R,{t:n.context.t,count:e.length,related:Object(D.f)(e)}),function(){return Promise.all(e.map(function(e){return n.props.deletePhoto(e)})).then(t)})}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,a["Component"]),n=t,(r=[{key:"dispatch",value:function(e){return this.context.store.dispatch(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.lists,o=t.fetchStatus,a=t.hasMore,c=t.fetchMore;return i.a.createElement(q.a,{actions:function(t){return{"album-add":e.showAddAlbumModal,download:e.downloadPhotos,delete:function(n){return e.deletePhotos(n,t.clear)}}}},function(t,u,s){return i.a.createElement("div",{"data-test-id":"timeline-pho-content-wrapper",className:f.a["pho-content-wrapper"]},i.a.createElement(m.a,{viewName:"photos"},i.a.createElement(P,{disabled:u,uploadPhotos:e.uploadPhotos,selectItems:s.show,t:n})),i.a.createElement(d.a,null,e.state.showAddAlbumModal&&i.a.createElement(D.b,{onDismiss:e.hideAddAlbumModal,onSuccess:s.clear,photos:t}),i.a.createElement(z.a,{lists:r,selected:t,photosContext:"timeline",showSelection:u,onPhotoToggle:s.toggle,onPhotosSelect:s.select,onPhotosUnselect:s.unselect,fetchStatus:o,hasMore:a,fetchMore:c})),e.renderViewer(e.props.children))})}},{key:"renderViewer",value:function(e){var t=this;return e?i.a.Children.map(e,function(e){return i.a.cloneElement(e,{photos:t.props.data||[]})}):null}}])&&K(n.prototype,r),c&&K(n,c),t}();X(te,"contextTypes",{t:l.a.func.isRequired,client:l.a.object.isRequired,store:l.a.object.isRequired});var ne=Object(u.c)()(te),re=n("NAv5");function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ae=function(e,t,n){var r=oe(t.substr(0,10).split("-"),3),o=r[0],a=r[1],i=r[2],c=oe(t.length>10?t.substr(11,8).split(":"):[0,0,0],3),u=c[0],s=c[1],l=c[2];return e(new Date(o,a-1,i,u,s,l),n)},ie=function(e,t){return ae(e,t,"HH")},ce=function(e,t){return ae(e,t,"DD MMMM")+ue(e,t)},ue=function(e,t){return Object(re.isThisYear)(t)?"":ae(e,t," YYYY")},se=function(e,t,n){var r=ae(e,t),o=ae(e,n);return 0===Object(re.differenceInCalendarDays)(r,o)};function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function pe(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function fe(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}n.d(t,"a",function(){return ge});var de=function(e){return e.find("io.cozy.files").where({class:"image",trashed:!1}).select(["dir_id","name","size","updated_at","metadata"]).sortBy({"metadata.datetime":"desc"}).include(["albums"])},me=function(e){return{uploadPhoto:(t=o.a.mark(function t(n,r){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.mutate({mutationType:"UPLOAD_PHOTO",execute:function(){return e.collection("io.cozy.files").createFile(n,{dirId:r})}}));case 1:case"end":return t.stop()}},t)}),n=function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){fe(a,r,o,i,c,"next",e)}function c(e){fe(a,r,o,i,c,"throw",e)}i(void 0)})},function(e,t){return n.apply(this,arguments)}),deletePhoto:function(t){return e.destroy(t)}};var t,n},he=function(e,t){if(e.period){var n=e.period.start,r=e.period.end;return function(e,t,n){var r=ae(e,t),o=ae(e,n);return 0===Object(re.differenceInCalendarMonths)(r,o)}(t,r,n)?se(t,r,n)?ce(t,n):function(e,t){return ae(e,t,"DD")}(t,n)+"-"+ce(t,r):ce(t,n)+" - "+ce(t,r)}return ce(t,e.name)},be=function(e,t,n,r){if(n.album&&(t>0&&se(r,e[t-1],e[t])||t<e.length-1&&se(r,e[t],e[t+1]))){var o=n.album.period.start,a=n.album.period.end,i=n.title+" Â· "+ie(r,o)+"h";return function(e,t,n){var r=ae(e,t),o=ae(e,n);return 0===Object(re.differenceInHours)(r,o)}(r,a,o)||(i+="-"+ie(r,a)+"h"),i}return n.title},ye=function(e,t,n){return Object.keys(e).find(function(r){if(e[r].album){var o=e[r].album.period.start,a=e[r].album.period.end;return(i=t,c=o,Object(re.compareAsc)(i,c)>=0&&function(e,t){return Object(re.compareAsc)(e,t)<=0}(t,a))||se(n,t,a)}return se(n,t,r);var i,c})},ve=function(e,t){var n={},r=[];e.forEach(function(e){var o=(e.albums?e.albums.data:[]).find(function(e){return e.auto});if(o){var a=o.name;if(!n.hasOwnProperty(a)){var i=he(o,t);n[a]={photos:[],title:i,album:o}}n[a].photos.push(e)}else r.push(e)}),r.forEach(function(e){var r=e.metadata&&e.metadata.datetime?e.metadata.datetime:e.created_at,o=ye(n,r,t);if(o)n[o].photos.push(e);else{var a=function(e,t){return ae(e,t,"YYYY-MM-DD")}(t,r);n[a]={title:ce(t,r),photos:[e]}}});var o=Object.keys(n);return o.sort(function(e,t){return new Date(t).getTime()-new Date(e).getTime()}),o.map(function(e,r){return{title:be(o,r,n[e],t),photos:n[e].photos}})},ge=(t.b=Object(u.c)()(function(e){return i.a.createElement(c.Query,{query:de,as:"timeline",mutations:me},function(t,n){var r=t.data,o=pe(t,["data"]);return i.a.createElement(ne,le({lists:r?ve(r,e.f):[],data:r},n,o,e))})}),Object(u.c)()(function(e){var t=e.selection,n=pe(e,["selection"]);return i.a.createElement(c.Query,{query:de},function(e){var r=e.data,o=pe(e,["data"]);return i.a.createElement(z.a,le({lists:r?ve(r,n.f):[],photosContext:"timeline",onPhotoToggle:t.toggle,onPhotosSelect:t.select,onPhotosUnselect:t.unselect},o,n))})}))},"2sk9":function(e,t,n){e.exports={"u-shake":"u-shake--301R8",shake:"shake--Hx9aG","u-o-100":"u-o-100--1l6_J","u-o-90":"u-o-90--Vl2PX","u-o-80":"u-o-80--1iZh6","u-o-70":"u-o-70--1Orn8","u-o-60":"u-o-60--29A2S","u-o-50":"u-o-50--1vWRz","u-o-40":"u-o-40--23WHb","u-o-30":"u-o-30--C42_r","u-o-20":"u-o-20--Wp1zJ","u-o-10":"u-o-10--1yTAG","u-o-05":"u-o-05--1IKgP","u-o-025":"u-o-025--2gpCh","u-o-0":"u-o-0--2YnvF","fil-confirm-text":"fil-confirm-text--3OV-5","icon-trash":"icon-trash--2L617","icon-restore":"icon-restore--qTvX6","icon-shared":"icon-shared--2ytpg","icon-related":"icon-related--3HRWq","icon-eye":"icon-eye--2EIWz","icon-link":"icon-link--2hb-A","icon-forbidden":"icon-forbidden--23UiV",spin:"spin--3SvvM"}},3:function(e,t){},"32XB":function(e,t,n){e.exports={"fil-actionmenu-inner":"fil-actionmenu-inner--3JhFX","fil-actionmenu-recipients":"fil-actionmenu-recipients--28pEX","fil-action":"fil-action--3huaS","fil-actionmenu-overlay":"fil-actionmenu-overlay--1o4R9","fil-mobileactionmenu":"fil-mobileactionmenu--2J9Kc","fil-mobileactionmenu-header":"fil-mobileactionmenu-header--j3KI4","fil-mobileactionmenu-file-name":"fil-mobileactionmenu-file-name--3VXSo","fil-mobileactionmenu-file-ext":"fil-mobileactionmenu-file-ext--2sio1","fil-action-phone-download":"fil-action-phone-download--3zG6S","fil-action-openWith":"fil-action-openWith--NJ1ah","fil-action-download":"fil-action-download--378G6","fil-action-destroy":"fil-action-destroy--1FAXj","fil-action-trash":"fil-action-trash--268pI","fil-action-restore":"fil-action-restore--36vfQ","fil-action-rename":"fil-action-rename--1hqjC","fil-action-share":"fil-action-share--1BpnI","fil-action-moveto":"fil-action-moveto--o2Fw2"}},"3Jea":function(e,t,n){e.exports={"u-shake":"u-shake--2w9Ah",shake:"shake--3lQxc","u-o-100":"u-o-100--fIdgC","u-o-90":"u-o-90--1n38D","u-o-80":"u-o-80--y360z","u-o-70":"u-o-70--35vTa","u-o-60":"u-o-60--s4-Cn","u-o-50":"u-o-50--3MPnn","u-o-40":"u-o-40--1PWFb","u-o-30":"u-o-30--1pEPX","u-o-20":"u-o-20--3PArr","u-o-10":"u-o-10--3F8WR","u-o-05":"u-o-05--_JIuM","u-o-025":"u-o-025--o8h8s","u-o-0":"u-o-0--3KlCg","shared-status":"shared-status--2MD96","shared-status-label":"shared-status-label--3Pk0H",spin:"spin--3YGV1"}},5:function(e,t,n){n("201c"),n("7NIr"),e.exports=n("oGE2")},"510Z":function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("17x9"),u=n.n(c),s=n("OTOu");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){p(a,r,o,i,c,"next",e)}function c(e){p(a,r,o,i,c,"throw",e)}i(void 0)})}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v="PENDING",g=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,n=!(o=(e=m(t)).call.apply(e,[this].concat(i)))||"object"!==l(o)&&"function"!=typeof o?h(r):o,y(h(n),"state",{status:v,src:null}),y(h(n),"_mounted",!1),n}var n,r,a,c,u,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i.a.Component),n=t,(r=[{key:"componentDidMount",value:function(){this._mounted=!0,this.loadNextSrc()}},{key:"componentWillUnmount",value:function(){this._mounted=!1,clearTimeout(this.timeout),this.img&&(this.img.onload=this.img.onerror=null,this.img.src="")}},{key:"getFileId",value:function(e){return e.id||e._id}},{key:"loadNextSrc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.status;t===v&&window.navigator.onLine?this.loadLink():"LOADING_LINK"===t?this.loadFallback():"LOADING_FALLBACK"!==t&&window.navigator.onLine||(s.a.warn("failed loading thumbnail",e),this.setState({status:"FAILED"}),this.props.onError(e))}},{key:"checkImageSource",value:function(e){var t=this,n=function(){clearTimeout(t.timeout),t.img.onload=t.img.onerror=null,t.img.src="",t.img=null};return new Promise(function(n,r){t.img=new Image,t.img.onload=n,t.img.onerror=r,t.img.src=e,t.timeout=setTimeout(function(){return r(new Error("Loading image took too long"))},1e4)}).then(n,n)}},{key:"getFileLinks",value:(p=f(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.links){e.next=4;break}return e.abrupt("return",t.links);case 4:return e.next=6,cozy.client.files.statById(this.getFileId(t),!1);case 6:if((n=e.sent).links){e.next=9;break}throw new Error("Could not fetch file links");case 9:return e.abrupt("return",n.links);case 10:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"loadLink",value:(u=f(o.a.mark(function e(){var t,n,r,a,i,c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:"LOADING_LINK"}),t=this.props,n=t.file,r=t.size,a=this.context.client,e.prev=3,e.next=6,this.getFileLinks(n,r);case 6:if(i=e.sent,c=i[r]){e.next=10;break}throw new Error("".concat(r," link is not available"));case 10:return u=a.options.uri+c,e.next=13,this.checkImageSource(u);case 13:this._mounted&&this.setState({status:"LOADED",src:u}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),this.loadNextSrc(e.t0);case 19:case"end":return e.stop()}},e,this,[[3,16]])})),function(){return u.apply(this,arguments)})},{key:"loadFallback",value:(c=f(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:"LOADING_FALLBACK"}),t=this.props.file,e.prev=2,e.next=5,this.getDownloadLink(this.getFileId(t));case 5:return n=e.sent,e.next=8,this.checkImageSource(n);case 8:this._mounted&&this.setState({status:"LOADED",src:n}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),this.loadNextSrc(e.t0);case 14:case"end":return e.stop()}},e,this,[[2,11]])})),function(){return c.apply(this,arguments)})},{key:"getDownloadLink",value:function(e){return this.context.client?this.context.client.collection("io.cozy.files").getDownloadLinkById(e):cozy.client.files.getDownloadLinkById(e).then(function(e){return"".concat(cozy.client._url).concat(e)})}},{key:"render",value:function(){var e=this.state.src,t=this.props,n=t.render,r=t.renderFallback;return e&&window.navigator.onLine?n(e):r?r():null}}])&&d(n.prototype,r),a&&d(n,a),t}();y(g,"contextTypes",{client:u.a.object.isRequired}),g.propTypes={file:u.a.object.isRequired,render:u.a.func.isRequired,size:u.a.oneOf(["small","medium","large"]),onError:u.a.func,renderFallback:u.a.func},g.defaultProps={size:"small",onError:function(){}};var w=g;n.d(t,"a",function(){return w})},"59mS":function(e,t,n){e.exports={"u-shake":"u-shake--jsFDP",shake:"shake--3-Vkv","u-o-100":"u-o-100--3NgxQ","u-o-90":"u-o-90--1HDpO","u-o-80":"u-o-80--1I9nb","u-o-70":"u-o-70--3QV-j","u-o-60":"u-o-60--1QLxy","u-o-50":"u-o-50--jArI6","u-o-40":"u-o-40--3Q8vH","u-o-30":"u-o-30--3LyB0","u-o-20":"u-o-20--3Aqqq","u-o-10":"u-o-10--3v5K_","u-o-05":"u-o-05--2aGws","u-o-025":"u-o-025--2bvm8","u-o-0":"u-o-0--h266O",spin:"spin--2CdRK"}},"5ZYL":function(e,t,n){e.exports={"pho-loading":"pho-loading--2vILC","pho-empty":"pho-empty--2ISCA"}},"5wWc":function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("i8i4"),i=n.n(a);t.a=function(e,t){var n=document.body.appendChild(document.createElement("div")),r=function(){t().then(function(){i.a.unmountComponentAtNode(n)})};i.a.render(o.a.cloneElement(e,{confirm:r,abort:function(){i.a.unmountComponentAtNode(n)}}),n)}},"6qED":function(e,t,n){e.exports={"pho-album-list":"pho-album-list--3W0t6","pho-album-list--thumbnails":"pho-album-list--thumbnails--3FASv","pho-album":"pho-album--nBuXk","pho-album-link":"pho-album-link--1J30Z","pho-album-photo-item":"pho-album-photo-item--18xZx","pho-album-title":"pho-album-title--1N0Rf","pho-album-description":"pho-album-description--3z6S7","pho-album-shared":"pho-album-shared--2T6ed","pho-album-list--selectable":"pho-album-list--selectable--1eSpV","pho-album-link--disabled":"pho-album-link--disabled--309dC"}},AzIT:function(e,t,n){e.exports={"coz-btn-client":"coz-btn-client--1LuMZ","coz-banner-client":"coz-banner-client--xEL17","coz-btn-clientMobile":"coz-btn-clientMobile--3n2yA","coz-banner-text":"coz-banner-text--tBptv","close-banner":"close-banner---KAV7",spin:"spin--2_Zjm",shake:"shake--1oABm"}},Bicm:function(e,t,n){e.exports={"shared-tooltip":"shared-tooltip--RvIBh","shared-tooltip-list":"shared-tooltip-list--VnQfr"}},"C/eS":function(e,t,n){e.exports={"pho-panel-form":"pho-panel-form--1S6en","coz-form":"coz-form--cCo_s","coz-form-group":"coz-form-group--1I069","coz-form-desc":"coz-form-desc--3FnDz","coz-form-label":"coz-form-label--385WH","coz-form-label--error":"coz-form-label--error--1Kr_k","coz-form-errors":"coz-form-errors--1RCYk",error:"error--3qEb3","pho-panel":"pho-panel--vFzlq","pho-panel-header":"pho-panel-header--2aCpb","pho-panel-footer":"pho-panel-footer--2Ynjt","pho-panel-controls":"pho-panel-controls--1UDSQ","pho-panel-content":"pho-panel-content--2OXQJ","pho-panel-wrap":"pho-panel-wrap--1OkG3",spin:"spin--t2Bmx",shake:"shake--2MjHG"}},D575:function(e,t,n){e.exports={"u-shake":"u-shake--3YTyo",shake:"shake--1nSjp","u-o-100":"u-o-100--2r8aL","u-o-90":"u-o-90--1ZQ1X","u-o-80":"u-o-80--oDMX9","u-o-70":"u-o-70--3_feB","u-o-60":"u-o-60--2C4Hh","u-o-50":"u-o-50--XX6w2","u-o-40":"u-o-40--2_9wP","u-o-30":"u-o-30--rXZXw","u-o-20":"u-o-20--2a2Jb","u-o-10":"u-o-10--kDgdQ","u-o-05":"u-o-05--23xdJ","u-o-025":"u-o-025--2ylev","u-o-0":"u-o-0--TB77K","coz-modal-section":"coz-modal-section--1g5-9","coz-create-album":"coz-create-album--1VWC2","coz-select-album":"coz-select-album--20TzS",spin:"spin--3Sc3l"}},DbnX:function(e,t,n){"use strict";var r=n("4BeY"),o=n.n(r),a=n("IaFt"),i=n.n(a),c=new o.a({id:"icon-checkbox_9e41a33868f3dad7314de1b6a47b358f",use:"icon-checkbox_9e41a33868f3dad7314de1b6a47b358f-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-checkbox_9e41a33868f3dad7314de1b6a47b358f">\n  <path fill="#32363f" fill-rule="evenodd" d="M64,129.99406 C64,128.892771 64.8945138,128 65.9940603,128 L78.0059397,128 C79.1072288,128 80,128.894514 80,129.99406 L80,142.00594 C80,143.107229 79.1054862,144 78.0059397,144 L65.9940603,144 C64.8927712,144 64,143.105486 64,142.00594 L64,129.99406 Z M67.7071068,137.292893 C67.3165825,136.902369 66.6834175,136.902369 66.2928932,137.292893 C65.9023689,137.683418 65.9023689,138.316582 66.2928932,138.707107 L68.2928932,140.707107 C68.6834175,141.097631 69.3165825,141.097631 69.7071068,140.707107 L77.7071068,132.707107 C78.0976311,132.316582 78.0976311,131.683418 77.7071068,131.292893 C77.3165825,130.902369 76.6834175,130.902369 76.2928932,131.292893 L69,138.585786 L67.7071068,137.292893 Z" transform="translate(-64 -128)" />\n</symbol>'});i.a.add(c);t.a=c},FKqX:function(e){e.exports={promoteDesktop:{isActivated:!0}}},Gofk:function(e,t,n){var r={"./en":"2OO4","./en.json":"2OO4"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="Gofk"},"I2Z/":function(e,t,n){e.exports={"u-shake":"u-shake--1_JDP",shake:"shake--Y2Op3","u-o-100":"u-o-100--2d2Nz","u-o-90":"u-o-90--31pSb","u-o-80":"u-o-80--3Ihkd","u-o-70":"u-o-70--YQ27F","u-o-60":"u-o-60--nEE6D","u-o-50":"u-o-50--3dLGa","u-o-40":"u-o-40--imJPw","u-o-30":"u-o-30--IxP_u","u-o-20":"u-o-20--32XM7","u-o-10":"u-o-10--1iaz5","u-o-05":"u-o-05--atgef","u-o-025":"u-o-025--3L2f7","u-o-0":"u-o-0--1NtAo","shared-badge":"shared-badge--2cmgU","--small":"_--small--thdoQ","shared-badge-icon":"shared-badge-icon--V-RtM","--xsmall":"_--xsmall--3hL0z","--by-me":"_--by-me--3gc-L","--with-me":"_--with-me--32UlG",spin:"spin--2woLM"}},KHOr:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("fvjX"),i=n("OTOu"),c=n("67rm"),u=n("q1tI"),s=n.n(u),l=n("TSYQ"),p=n.n(l),f=n("/MKj"),d=n("buk/"),m=n("V2U0"),h=n("y6ex"),b=n("yoMi"),y=n("OjRq"),v=n("lEMr"),g=n.n(v);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=Object(d.c)()(function(e){return s.a.createElement("span",{className:g.a["item-pending"]},e.t("UploadQueue.item.pending"))}),x=Object(d.c)()(function(e){var t,n,r=e.file,o=e.status,a=y.b.splitFilename(r),i=a.filename,c=a.extension;switch(o){case"loading":n=s.a.createElement(m.b,{className:"u-ml-half",color:b.dodgerBlue});break;case"cancel":n=s.a.createElement(h.a,{className:"u-ml-half",icon:"cross",color:b.monza});break;case"failed":case"conflict":case"network":n=s.a.createElement(h.a,{className:"u-ml-half",icon:"warning",color:b.monza});break;case"loaded":n=s.a.createElement(h.a,{className:"u-ml-half",icon:"check-circleless",color:b.emerald});break;case"pending":default:n=s.a.createElement(S,null)}return s.a.createElement("div",{className:p()(g.a["upload-queue-item"],(t={},j(t,g.a["upload-queue-item--done"],"loaded"===o),j(t,g.a["upload-queue-item--error"],"failed"===o||"conflict"===o),t))},s.a.createElement("div",{className:p()(g.a["item-cell"],g.a["item-file"],g.a["item-image"])},s.a.createElement("div",null,i,c&&s.a.createElement("span",{className:g.a["item-ext"]},c))),s.a.createElement("div",{className:g.a["item-status"]},n))}),P=Object(d.c)()(function(e){var t=e.t,n=e.total,r=e.done;return s.a.createElement("div",{className:g.a["upload-queue-header-inner"]},s.a.createElement("span",{className:"coz-desktop"},t("UploadQueue.header",{smart_count:n})),s.a.createElement("span",{className:g.a["u-hide--desk"]},t("UploadQueue.header_mobile",{done:r,total:n})))}),C=Object(d.c)()(function(e){var t=e.t,n=e.total,r=e.successful,o=e.onClose;return s.a.createElement("div",{"data-test-id":"upload-queue-success",className:g.a["upload-queue-header-inner"]},s.a.createElement("span",null,t("UploadQueue.header_done",{done:r,total:n})),s.a.createElement("button",{className:p()(g.a["btn-close"]),onClick:o},t("UploadQueue.close")))}),A=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=O(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==w(o)&&"function"!=typeof o?E(r):o,j(E(n),"state",{collapsed:!1}),j(E(n),"toggleCollapsed",function(){n.setState(function(e){return{collapsed:!e.collapsed}})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u["Component"]),n=t,(r=[{key:"render",value:function(){var e,t=this.props,n=t.queue,r=t.doneCount,o=t.successCount,a=t.purgeQueue,i=this.state.collapsed;return s.a.createElement("div",{"data-test-id":"upload-queue",className:p()(g.a["upload-queue"],(e={},j(e,g.a["upload-queue--visible"],0!==n.length),j(e,g.a["upload-queue--collapsed"],i),e))},s.a.createElement("h4",{className:g.a["upload-queue-header"],onDoubleClick:this.toggleCollapsed},r<n.length?s.a.createElement(P,{total:n.length,done:r}):s.a.createElement(C,{total:n.length,successful:o,onClose:a})),s.a.createElement("progress",{className:g.a["upload-queue-progress"],value:r,max:n.length}),s.a.createElement("div",{className:g.a["upload-queue-content"]},s.a.createElement("div",{className:g.a["upload-queue-list"]},n.map(function(e,t){return s.a.createElement(x,{file:e.file,status:e.status,key:"file_".concat(t)})}))))}}])&&_(n.prototype,r),o&&_(n,o),t}(),T=Object(d.c)()(Object(f.connect)(function(e){return{queue:Y(e),doneCount:K(e).length,successCount:W(e).length}},function(e){return{purgeQueue:function(){return e(B())}}})(A));function R(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function N(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){R(a,r,o,i,c,"next",e)}function c(e){R(a,r,o,i,c,"throw",e)}i(void 0)})}}function z(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"b",function(){return M}),n.d(t,"g",function(){return B}),n.d(t,"f",function(){return Y}),n.d(t,"d",function(){return K}),n.d(t,"e",function(){return W}),n.d(t,"a",function(){return T});var L=function(e){return{file:e,status:"pending"}},D=function(e){switch(e.type){case"UPLOAD_FILE":return"loading";case"RECEIVE_UPLOAD_SUCCESS":return"loaded";case"RECEIVE_UPLOAD_ERROR":return e.status}},q=function(e,t){return Object.assign({},e,{status:D(t)})},I=(t.c=Object(a.combineReducers)({queue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_TO_UPLOAD_QUEUE":return[].concat(z(e),z(t.files.map(function(e){return L(e)})));case"PURGE_UPLOAD_QUEUE":return[];case"UPLOAD_FILE":case"RECEIVE_UPLOAD_SUCCESS":case"RECEIVE_UPLOAD_ERROR":return e.map(function(e){return e.file.name!==t.file.name?e:q(e,t)});default:return e}}}),function e(t){return function(){var n=N(o.a.mark(function n(r,a){var c,u;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(c=Y(a()).find(function(e){return"pending"===e.status})){n.next=3;break}return n.abrupt("return",r(F()));case 3:return u=c.file,n.prev=4,r({type:"UPLOAD_FILE",file:u}),n.next=8,t(u);case 8:r({type:"RECEIVE_UPLOAD_SUCCESS",file:u}),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),i.a.log(n.t0),r({type:"RECEIVE_UPLOAD_ERROR",file:u,status:409===n.t0.status?"conflict":"failed"});case 15:r(e(t));case 16:case"end":return n.stop()}},n,null,[[4,11]])}));return function(e,t){return n.apply(this,arguments)}}()}),M=function(e,t){return function(){var n=N(o.a.mark(function n(r){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r({type:"ADD_TO_UPLOAD_QUEUE",files:e}),r(I(t));case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()},B=function(){return{type:"PURGE_UPLOAD_QUEUE"}},F=function(){return function(e,t){var n=Y(t()),r=G(n),o=V(n),a=H(n);r.length||o.length?r.length&&!o.length?c.a.info("UploadQueue.alert.success_conflicts",{smart_count:a.length,conflictNumber:r.length}):c.a.error("UploadQueue.alert.errors"):c.a.success("UploadQueue.alert.success",{smart_count:a.length})}},U=function(e,t){return e.filter(function(e){return e.status===t})},G=function(e){return U(e,"conflict")},V=function(e){return U(e,"failed")},H=function(e){return U(e,"loaded")},Y=function(e){return e.upload.queue},K=function(e){return Y(e).filter(function(e){return"pending"!==e.status})},W=function(e){return H(Y(e))}},KOJc:function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("buk/"),i=n("GoJ1"),c=n("4BeY"),u=n.n(c),s=n("IaFt"),l=n.n(s),p=new u.a({id:"icon-type-folder_f49493c812ab389aaac1e61434f7995f",use:"icon-type-folder_f49493c812ab389aaac1e61434f7995f-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-type-folder_f49493c812ab389aaac1e61434f7995f">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 2)">\n    <rect width="32" height="26" y="2" fill="#B2D3FF" rx="2" />\n    <path fill="#197BFF" d="M0,0.990777969 C0,0.443586406 0.449948758,0 1.00684547,0 L12.9931545,0 C13.5492199,0 14.3125,0.3125 14.7107565,0.71075654 L15.2892435,1.28924346 C15.6817835,1.68178346 16.4446309,2 17.0008717,2 L30.0059397,2 C31.1072288,2 32,2.89470506 32,4 L32,4 L17.0008717,4 C16.4481055,4 15.6875,4.3125 15.2892435,4.71075654 L14.7107565,5.28924346 C14.3182165,5.68178346 13.5500512,6 12.9931545,6 L1.00684547,6 C0.450780073,6 0,5.54902482 0,5.00922203 L0,0.990777969 Z" />\n  </g>\n</symbol>'}),f=(l.a.add(p),p),d=new u.a({id:"icon-main-app_5a0af3714e77328d0c04b0d83712f645",use:"icon-main-app_5a0af3714e77328d0c04b0d83712f645-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-main-app_5a0af3714e77328d0c04b0d83712f645">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 3)">\n    <rect width="32" height="26" fill="#8EE39B" rx="2" />\n    <path fill="#1EC737" d="M0,20 L6.29028051,13.7097195 C6.68224776,13.3177522 7.31387329,13.3138733 7.70591205,13.7059121 L11,17 L19.2937851,8.7062149 C19.6838168,8.31618318 20.320971,8.32097101 20.7058543,8.70585426 L32,20 L32,24.0020869 C32,25.1055038 31.1107383,26 29.9982567,26 L2.00174332,26 C0.89621101,26 0,25.1017394 0,24.0020869 L0,20 Z" />\n    <circle cx="8" cy="7" r="3" fill="#FFFFFF" />\n    <path stroke="#8EE39B" d="M11,16 L5.5,21.5 L11,16 Z" stroke-linecap="round" stroke-linejoin="round" />\n  </g>\n</symbol>'}),m=(l.a.add(d),d),h=new u.a({id:"icon-trash-big_48355d429631705f7ab5001494a0529c",use:"icon-trash-big_48355d429631705f7ab5001494a0529c-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-trash-big_48355d429631705f7ab5001494a0529c">\n  <g fill="none" fill-rule="evenodd" transform="translate(2)">\n    <path fill="#D1D5DB" d="M2,8 L26,8 L26,28.009947 C26,30.2135924 24.2157067,32 22.009947,32 L5.99005301,32 C3.78640758,32 2,30.2157067 2,28.009947 L2,8 Z" />\n    <path fill="#A3ACB8" d="M7,2 L1.99124431,2 C0.899897516,2 0,2.8954305 0,4 L0,6 L28,6 L28,4 C28,2.88772964 27.1084896,2 26.0087557,2 L21,2 L20.4438648,0.887729645 C20.1990795,0.398159027 19.5511774,0 18.9975267,0 L9.00247329,0 C8.45576096,0 7.80127495,0.3974501 7.55613518,0.887729645 L7,2 Z" />\n  </g>\n</symbol>'}),b=(l.a.add(h),h);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,"a",function(){return w});var v={drive:f,photos:m,trash:b},g=Object(a.c)()(function(e){var t=e.t,n=e.type,r=e.canUpload,a=e.localeKey;return o.a.createElement(i.a,{"data-test-id":"empty-folder",icon:v[n],title:t(a?"empty.".concat(a,"_title"):"empty.title"),text:a&&t("empty.".concat(a,"_text"))||r&&t("empty.text")})}),w=function(e){return o.a.createElement(g,y({type:"photos"},e))}},NqoY:function(e,t,n){"use strict";var r=n("z6Q1"),o=n("Le8U"),a=n("SH7X");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,s(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a["HasMany"]),n=t,o=[{key:"query",value:function(e,t,n){if(!e.relationships||!e.relationships.referenced_by||!e.relationships.referenced_by.data)return null;var r=e.relationships.referenced_by.data.filter(function(e){return e.type===n.doctype}).map(function(e){return e.id});return new a.QueryDefinition({doctype:n.doctype,ids:r})}}],(r=[{key:"data",get:function(){var e=this,t=this.target.relationships.referenced_by.data;return t?t.map(function(t){return e.get(t.type,t.id)}).filter(Boolean):[]}}])&&c(n.prototype,r),o&&c(n,o),t}();t.a={albums:{doctype:r.a,attributes:{name:{type:"string"}},relationships:{photos:{type:"has-many",doctype:r.c}}},files:{doctype:r.c,relationships:{albums:{type:p,doctype:r.a}}},contacts:{doctype:o.Contact.doctype}}},OTOu:function(e,t,n){"use strict";var r=n("i9cR"),o=n.n(r),a=o()("cozy-".concat("photos"));o.a.enable(),o.a.suggest.allow("cozy-".concat("photos"),"log"),o.a.suggest.allow("cozy-".concat("photos"),"info"),t.a=a},OjRq:function(e,t,n){"use strict";var r=n("Le8U");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,c(t).apply(this,arguments))}var n,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r["Contact"]),n=t,s=[{key:"getInitials",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t.isContact(e))return r.Contact.getInitials(e);var o=e.public_name||e.name||e.email;return o&&o[0].toUpperCase()||n}},{key:"getDisplayName",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.isContact(e)?r.Contact.getDisplayName(e):e.public_name||e.name||e.email||n}}],(o=null)&&a(n.prototype,o),s&&a(n,s),t}();n.d(t,"b",function(){return r.CozyFile}),n.d(t,"c",function(){return r.Group}),n.d(t,"a",function(){return s})},RPnM:function(e,t,n){"use strict";var r=n("kKu1"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("KXWi"),u=n("V2U0"),s=n("yoMi");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=f(this,d(t).call(this,e))).state={fetching:!1},n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,a["Component"]),n=t,(r=[{key:"handleClick",value:function(){var e=this;this.setState({fetching:!0}),this.props.onClick().then(function(){return e.setState({fetching:!1})})}},{key:"render",value:function(){var e=this,t=this.props,n=t.label,r=t.width,a=void 0===r?"100%":r,l=this.state.fetching;return i.a.createElement("div",{style:{width:a},className:o.a["pho-list-morebutton"]},l&&i.a.createElement(c.a,{disabled:!0,theme:"secondary",label:i.a.createElement(u.b,{color:s.dodgerBlue,nomargin:!0})}),!l&&i.a.createElement(c.a,{theme:"secondary",onClick:function(){return e.handleClick()},label:n}))}}])&&p(n.prototype,r),l&&p(n,l),t}();t.a=h},SRpc:function(e,t,n){"use strict";var r=n("o0o1"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("dtw8"),u=n("SH7X"),s=n("17x9"),l=n.n(s),p=n("4kcP"),f=n("mwIZ"),d=n.n(f);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function y(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){var t=e.instanceUri,n=e.sharings,r=void 0===n?[]:n,o=e.permissions,a=void 0===o?[]:o,i=e.apps,c=void 0===i?[]:i;return{type:"RECEIVE_SHARINGS",data:{sharings:r.filter(function(e){return!re(e)&&!oe(e,t)}),permissions:a,apps:c}}},_=function(e,t){return{type:"ADD_SHARING",data:e,path:t}},O=function(e){return{type:"UPDATE_SHARING",sharing:e}},E=function(e,t,n){return{type:"REVOKE_RECIPIENT",sharing:v({},e,{attributes:v({},e.attributes,{members:e.attributes.members.map(function(e,n){return n===t?v({},e,{status:"revoked"}):e})})}),path:n}},k=function(e){return{type:"REVOKE_SELF",sharing:e}},j=function(e){return{type:"ADD_SHARING_LINK",data:e}},S=function(e){return{type:"REVOKE_SHARING_LINK",permissions:e}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t){return t.instance&&t.instance.toString().toLowerCase()===e.toLowerCase()}},P={sharings:[],permissions:[]},C=function(e,t,n){var r,o=e[t],a=b(e,[t].map(y)),i=n(o||P);return 0===(r=i).sharings.length&&0===r.permissions.length?a:v({},a,g({},t,i))},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return ee(t).reduce(function(e,n){return C(e,n,function(e){return v({},e,{sharings:[].concat(h(e.sharings),[t.id])})})},e)},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return ee(t).reduce(function(e,n){return C(e,n,function(e){return v({},e,{sharings:e.sharings.filter(function(e){return e!==t.id})})})},e)},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return ee(t).reduce(function(e,n){return C(e,n,function(e){return v({},e,{permissions:[].concat(h(e.permissions),[t.id])})})},e)},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return ee(t).reduce(function(e,n){return C(e,n,function(e){return v({},e,{permissions:e.permissions.filter(function(e){return e!==t.id})})})},e)},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":var n=t.data.sharings.reduce(function(e,t){return A(e,t)},e);return t.data.permissions.reduce(function(e,t){return R(e,t)},n);case"ADD_SHARING":return A(e,t.data);case"REVOKE_RECIPIENT":return re(t.sharing)?T(e,t.sharing):e;case"ADD_SHARING_LINK":return R(e,t.data);case"REVOKE_SELF":return T(e,t.sharing);case"REVOKE_SHARING_LINK":return t.permissions.reduce(function(e,t){return N(e,t)},e);default:return e}},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.permissions;case"ADD_SHARING_LINK":return[].concat(h(e),[t.data]);case"REVOKE_SHARING_LINK":var n=t.permissions.map(function(e){return e.id});return e.filter(function(e){return-1===n.indexOf(e.id)});default:return e}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.apps;default:return e}},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHARINGS":return t.data.sharings;case"ADD_SHARING":return[].concat(h(e),[t.data]);case"UPDATE_SHARING":case"REVOKE_RECIPIENT":return e.map(function(e){return e.id!==t.sharing.id?e:t.sharing});case"REVOKE_SELF":return e.filter(function(e){return e.id!==t.sharing.id});default:return e}},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_PATHS":return t.paths;case"ADD_SHARING":return[].concat(h(e),[t.path]);case"REVOKE_RECIPIENT":return re(t.sharing)?e.filter(function(e){return e!==t.path}):e;default:return e}},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{byDocId:z(e.byDocId,t),sharings:q(e.sharings,t),permissions:L(e.permissions,t),apps:D(e.apps,t),sharedPaths:I(e.sharedPaths,t)}},B=function(e,t){return!e.byDocId[t]||0===e.byDocId[t].sharings.length||!0===Z(e,e.byDocId[t].sharings[0]).attributes.owner},F=function(e,t,n){var r=K(e,t),o=r.attributes.members.find(x(n));return!0===r.attributes.open_sharing&&o&&!o.read_only},U=function(e,t){return G(e,t).find(function(e){return"owner"===e.status})},G=function(e,t){var n=W(e,t).map(function(e){var n=ae(e,t);return e.attributes.members.map(function(t,r){return v({},t,{type:t.read_only?"one-way":n,sharingId:e.id,index:r})})}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return"revoked"!==e.status});return n[0]&&"owner"===n[0].status?[n[0]].concat(h(n.filter(function(e){return"owner"!==e.status}))):n},V=function(e,t,n){var r=Q(e,t);if(0===r.length)return null;var o=r[0],a=d()(o,"attributes.shortcodes.email")||d()(o,"attributes.codes.email");return a?ie(e,n,a):null},H=function(e,t){return K(e,t)},Y=function(e,t,n){var r=H(e,t),o=ae(r,t);if(r.attributes.owner)return o;var a=r.attributes.members.find(x(n));return a&&a.read_only?"one-way":o},K=function(e,t){return W(e,t)[0]||null},W=function(e,t){return e.byDocId[t]?e.byDocId[t].sharings.map(function(t){return Z(e,t)}):[]},Z=function(e,t){return e.sharings.find(function(e){return e.id===t})},Q=function(e,t){return e.byDocId[t]?e.byDocId[t].permissions.map(function(t){return X(e,t)}):[]},X=function(e,t){return e.permissions.find(function(e){return e.id===t})},J=function(e,t){return e.sharedPaths.some(function(e){return 0===t.path.indexOf("".concat(e,"/"))})},$=function(e,t){return e.sharedPaths.some(function(e){return 0===e.indexOf("".concat(t.path,"/"))})},ee=function(e){return"io.cozy.sharings"===e.type?te(e):ne(e)},te=function(e){return e.attributes.rules.map(function(e){return e.values}).reduce(function(e,t){return e.concat(t)},[])},ne=function(e){return Object.keys(e.attributes.permissions).map(function(t){return e.attributes.permissions[t].values}).reduce(function(e,t){return[].concat(h(e),h(t))},[])},re=function(e){return e.attributes.owner&&1===e.attributes.members.filter(function(e){return"revoked"!==e.status}).length},oe=function(e,t){var n=e.attributes.members.find(x(t));return!e.attributes.owner&&n&&"revoked"===n.status},ae=function(e,t){if(!e)return null;var n=e.attributes.rules.find(function(e){return-1!==e.values.indexOf(t)});return"sync"===n.update&&"sync"===n.remove?"two-way":"one-way"},ie=function(e,t,n){var r=ce(e,t);return"".concat(r,"public?sharecode=").concat(n)},ce=function(e,t){var n=function(e){return e.apps}(e);switch(t){case"Files":case"Document":return ue(n,"drive");case"Albums":return ue(n,"photos");default:throw new Error("Sharing link: don't know which app to use for doctype ".concat(t))}},ue=function(e,t){var n=e.find(function(e){return e.attributes.slug===t&&"ready"===e.attributes.state});if(!n)throw new Error("Sharing link: app ".concat(t," not installed"));return n.links.related},se=i.a.createContext(),le=n("TSYQ"),pe=n.n(le),fe=n("y6ex");n("I2Z/");var de=n("KXWi"),me=n("Te91"),he=n.n(me);function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ye(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var ve=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(de.a,be({"data-test-id":"share-by-me-button",className:pe()(he.a["coz-btn-shared"],r),onClick:function(){return n()},icon:"share",label:t},o))},ge=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(de.a,be({className:pe()(he.a["coz-btn-sharedWithMe"],r),onClick:function(){return n()},icon:"share",label:t},o))},we=function(e){var t=e.label,n=e.onClick,r=e.className,o=ye(e,["label","onClick","className"]);return i.a.createElement(de.a,be({"data-test-id":"share-button",theme:"secondary",className:r,onClick:function(){return n()},icon:"share",label:t},o))},_e=n("56YH"),Oe=n.n(_e),Ee=n("OjRq"),ke=l.a.shape({count:l.a.number,data:l.a.arrayOf(Ee.a.propType),definition:l.a.object,fetchMore:l.a.func,fetchStatus:l.a.string,hasMore:l.a.bool,id:l.a.string,lastError:l.a.string,lastFetch:l.a.number,lastUpdate:l.a.number}),je=l.a.shape({count:l.a.number,data:l.a.arrayOf(Ee.c.propType),definition:l.a.object,fetchMore:l.a.func,fetchStatus:l.a.string,hasMore:l.a.bool,id:l.a.string,lastError:l.a.string,lastFetch:l.a.number,lastUpdate:l.a.number});function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Pe(this,Ce(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(t,a["Component"]),n=t,(r=[{key:"shouldComponentUpdate",value:function(e){return e.contacts.hasMore!==this.props.contacts.hasMore||e.contacts.fetchStatus!==this.props.contacts.fetchStatus||e.contacts.data.length!==this.props.contacts.data.length||e.groups.hasMore!==this.props.groups.hasMore||e.groups.fetchStatus!==this.props.groups.fetchStatus||e.groups.data.length!==this.props.groups.data.length}},{key:"componentDidUpdate",value:function(){this.props.contacts.hasMore&&this.props.contacts.fetchMore(),this.props.groups.hasMore&&this.props.groups.fetchMore()}},{key:"render",value:function(){return this.props.children}}])&&xe(n.prototype,r),o&&xe(n,o),t}(),Re=n("cLsY"),Ne=n("jrFr"),ze=n.n(Ne),Le=n("WWur"),De=n.n(Le),qe=n("Vmsy"),Ie=n("kyGY"),Me=n("V2U0"),Be=n("67rm"),Fe=n("OTOu"),Ue=n("7jrE"),Ge=n.n(Ue);function Ve(e){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Je(e,t,n[t])})}return e}function Ye(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function Ke(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ye(a,r,o,i,c,"next",e)}function c(e){Ye(a,r,o,i,c,"throw",e)}i(void 0)})}}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $e=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Ze(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Ve(o)&&"function"!=typeof o?Qe(r):o,Je(Qe(n),"state",{loading:!1}),Je(Qe(n),"toggleShareLink",function(e){e?n.createShareLink():n.deleteShareLink()}),Je(Qe(n),"copyLinkToClipboard",function(){De()(n.props.link)?Be.a.success("".concat(n.props.documentType,".share.shareByLink.copied")):Be.a.error("".concat(n.props.documentType,".share.shareByLink.failed"))}),n}var n,r,a,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,i.a.Component),n=t,(r=[{key:"createShareLink",value:(u=Ke(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setState(function(e){return He({},e,{loading:!0})}),e.next=4,this.props.onEnable(this.props.document);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),Be.a.error("".concat(this.props.documentType,".share.error.generic")),Fe.a.log(e.t0);case 10:return e.prev=10,this.setState(function(e){return He({},e,{loading:!1})}),e.finish(10);case 13:case"end":return e.stop()}},e,this,[[0,6,10,13]])})),function(){return u.apply(this,arguments)})},{key:"deleteShareLink",value:(c=Ke(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setState(function(e){return He({},e,{loading:!0})}),e.next=4,this.props.onDisable(this.props.document);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),Be.a.error("".concat(this.props.documentType,".share.error.revoke")),Fe.a.log(e.t0);case 10:return e.prev=10,this.setState(function(e){return He({},e,{loading:!1})}),e.finish(10);case 13:case"end":return e.stop()}},e,this,[[0,6,10,13]])})),function(){return c.apply(this,arguments)})},{key:"render",value:function(){var e=this.context.t,t=this.state.loading,n=this.props,r=n.checked,o=n.documentType;return i.a.createElement("div",null,i.a.createElement("div",{"data-test-id":"share-by-link",className:pe()(ze.a["share-bylink-header"],"u-mt-1","u-mb-1")},i.a.createElement(Ie.c,null,e("".concat(o,".share.shareByLink.subtitle"))),t&&i.a.createElement(Me.b,{color:Ge.a.dodgerBlue}),t&&i.a.createElement("span",{className:ze.a["share-bylink-header-creating"]},e("".concat(o,".share.shareByLink.creating"))),r&&i.a.createElement("span",{className:ze.a["share-bylink-header-dot"]}),r&&i.a.createElement("button",{"data-test-url":this.props.link,className:ze.a["share-bylink-header-copybtn"],onClick:this.copyLinkToClipboard},e("".concat(o,".share.shareByLink.copy"))),i.a.createElement(qe.a,{id:"share-toggle",name:"share",checked:r,disabled:t,onToggle:this.toggleShareLink})),i.a.createElement("div",{className:ze.a["share-bylink-desc"]},e("".concat(o,".share.shareByLink.desc"))))}}])&&We(n.prototype,r),a&&We(n,a),t}();Je($e,"contextTypes",{t:l.a.func.isRequired});var et=$e,tt=n("y2Vs"),nt=n("xjMU"),rt=n("1h/R"),ot=n.n(rt),at=n("fWVu"),it=n.n(at),ct=n("4BeY"),ut=n.n(ct),st=n("IaFt"),lt=n.n(st),pt=new ut.a({id:"icon-cross-bold_768adbba35f30227bde1acbc224e1604",use:"icon-cross-bold_768adbba35f30227bde1acbc224e1604-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16" id="icon-cross-bold_768adbba35f30227bde1acbc224e1604">\n  <defs>\n    <path d="M8 6.586l5.293-5.293a1 1 0 0 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 1 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 1 1 1.414-1.414L8 6.586z" id="icon-cross-bold_768adbba35f30227bde1acbc224e1604_a" />\n  </defs>\n  <use fill="#32363F" fill-rule="nonzero" xlink:href="#icon-cross-bold_768adbba35f30227bde1acbc224e1604_a" />\n</symbol>'}),ft=(lt.a.add(pt),pt),dt=n("Le8U"),mt=n("BuRe"),ht=n("buk/"),bt=n("1BUi"),yt=n.n(bt),vt=function(e){var t=e.name,n=e.details;return i.a.createElement("div",{className:pe()(yt.a["recipient-idents"],"u-ml-1")},i.a.createElement("div",{className:yt.a["recipient-user"]},t),i.a.createElement("div",{className:yt.a["recipient-details"]},n))};vt.propTypes={name:l.a.string.isRequired,details:l.a.string},vt.defaultProps={details:"-"};var gt=vt,wt=function(e){var t,n,r,o=e.contactOrGroup,a=e.contacts,c=e.t;o._type===Ee.c.doctype?(n=o.name,r=c("Share.members.count",{smart_count:a.reduce(function(e,t){return d()(t,"relationships.groups.data",[]).map(function(e){return e._id}).includes(o._id)?e+1:e},0).toString()}),t="G"):(n=Ee.a.getDisplayName(o),t=Ee.a.getInitials(o),r=Ee.a.getPrimaryCozy(o));return i.a.createElement("div",{className:yt.a.recipient},i.a.createElement(mt.a,{text:t,size:"small"}),i.a.createElement(gt,{name:n,details:r}))};wt.propTypes={contactOrGroup:l.a.oneOfType([Ee.a.propType,Ee.c.propType]).isRequired,contacts:l.a.arrayOf(Ee.a.propType),t:l.a.func.isRequired};var _t=Object(ht.c)()(wt);function Ot(){return(Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ct(e,t,n[t])})}return e}function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e,t){return(Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var At=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=St(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Et(o)&&"function"!=typeof o?xt(r):o,Ct(xt(n),"state",{inputValue:"",suggestions:[]}),Ct(xt(n),"onSuggestionsFetchRequested",function(e){var t=e.value;n.setState(function(e){return kt({},e,{suggestions:n.computeSuggestions(t)})})}),Ct(xt(n),"onSuggestionsClearRequested",function(){n.setState(function(e){return kt({},e,{suggestions:[]})})}),Ct(xt(n),"onChange",function(e,t){var r=t.newValue,o=t.method;"object"!==Et(r)?n.setState(function(e){return kt({},e,{inputValue:r})}):"click"!==o&&"enter"!==o||n.onPick(r)}),Ct(xt(n),"onKeyPress",function(e){(("Enter"===e.key||13===e.keyCode)&&""!==n.state.inputValue||("Space"===e.key||32===e.keyCode)&&/^.+@.+/.test(n.state.inputValue))&&n.onPick({email:n.state.inputValue})}),Ct(xt(n),"onFocus",function(){n.props.onFocus()}),Ct(xt(n),"onBlur",function(e,t){var r=t.highlightedSuggestion;r?(n.props.onPick(r),n.setState(function(e){return kt({},e,{inputValue:""})})):""!==n.state.inputValue&&n.state.inputValue.match(/\S+@\S+/)&&(n.props.onPick({email:n.state.inputValue}),n.setState(function(e){return kt({},e,{inputValue:""})}))}),Ct(xt(n),"onPick",function(e){n.props.onPick(e),n.setState(function(e){return kt({},e,{inputValue:""})}),setTimeout(function(){return n.input.focus()},1)}),Ct(xt(n),"onRemove",function(e){n.props.onRemove(e),setTimeout(function(){return n.input.focus()},1)}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pt(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidUpdate",value:function(e){this.props.contactsAndGroups.length!==e.contactsAndGroups.length&&this.onSuggestionsFetchRequested({value:this.state.inputValue})}},{key:"computeSuggestions",value:function(e){var t=e.trim().toLowerCase();return 0===t.length?[]:this.props.contactsAndGroups.filter(function(e){return function(e,t){return t._type===dt.Group.doctype&&new RegExp(e,"i").test(t.name)}(t,e)||function(e,t){if(!t.email)return!1;var n=new RegExp(e,"i");return Array.isArray(t.email)?t.email.some(function(e){return n.test(e.address)}):n.test(t.email)}(t,e)||function(e,t){if(!t.cozy&&!t.url)return!1;var n=new RegExp(e,"i");return t.cozy&&Array.isArray(t.cozy)?t.cozy.some(function(e){return n.test(e.url)}):n.test(t.url)}(t,e)})}},{key:"renderInput",value:function(e){var t=this,n=this.props,r=n.loading,o=n.recipients;return i.a.createElement("div",{className:it.a.recipientsContainer},o.map(function(e,n){var r=Ee.a.getDisplayName(e);return i.a.createElement("div",{className:it.a.recipientChip,key:"key_recipient_".concat(n)},i.a.createElement("span",null,r),i.a.createElement("button",{className:it.a.removeRecipient,onClick:function(){return t.onRemove(e)}},i.a.createElement(fe.a,{icon:ft,width:"16",height:"16"})))}),i.a.createElement("input",Ot({},e,{onKeyPress:this.onKeyPress})),r&&i.a.createElement(Me.b,{color:Ge.a.dodgerBlue,className:"u-flex u-flex-items-center"}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.inputValue,r=t.suggestions,o=this.props,a=o.contactsAndGroups,c=o.placeholder;return i.a.createElement(ot.a,{ref:function(t){e.input=t?t.input:null},theme:it.a,suggestions:r.slice(0,20),getSuggestionValue:function(e){return e},onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,renderSuggestion:function(e){return i.a.createElement(_t,{contacts:a.filter(function(e){return e._type===Ee.a.doctype}),contactOrGroup:e})},renderInputComponent:function(t){return e.renderInput(t)},highlightFirstSuggestion:!0,inputProps:{onFocus:this.onFocus,onChange:this.onChange,onBlur:this.onBlur,value:n,type:"email",placeholder:c}})}}])&&jt(n.prototype,r),o&&jt(n,o),t}();function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zt(e){return(zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var It=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=zt(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Tt(o)&&"function"!=typeof o?Lt(r):o,qt(Lt(n),"state",{loading:!1}),qt(Lt(n),"onFocus",function(){var e=n.props,t=e.contacts,r=e.groups;(t.hasMore||"loading"===t.fetchStatus||r.hasMore||"loading"===r.fetchStatus)&&n.setState({loading:!0})}),qt(Lt(n),"getContactsAndGroups",function(){var e=n.props,t=e.contacts,r=e.groups;return t.hasMore||"loading"===t.fetchStatus?t.data:[].concat(Rt(t.data),Rt(r.data))}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dt(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.contacts,n=e.groups;!this.state.loading||t.hasMore||"loaded"!==t.fetchStatus||n.hasMore||"loaded"!==n.fetchStatus||this.setState({loading:!1})}},{key:"render",value:function(){var e=this.props,t=e.label,n=e.onPick,r=e.onRemove,o=e.placeholder,a=e.recipients,c=this.state.loading;return i.a.createElement("div",null,i.a.createElement("label",{className:ze.a["coz-form-label"],htmlFor:"email"},t),i.a.createElement(At,{loading:c,contactsAndGroups:this.getContactsAndGroups(),recipients:a,onFocus:this.onFocus,onPick:n,onRemove:r,placeholder:o}))}}])&&Nt(n.prototype,r),o&&Nt(n,o),t}();qt(It,"contextTypes",{client:l.a.object.isRequired}),It.propTypes={label:l.a.string,contacts:ke.isRequired,groups:je.isRequired,recipients:l.a.array,onPick:l.a.func.isRequired,onRemove:l.a.func.isRequired,placeholder:l.a.string},It.defaultProps={label:"To:",recipients:[]};var Mt=It;function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Kt(e,t,n[t])})}return e}function Kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wt=function(e){return i.a.createElement(tt.a.DropdownIndicator,e,i.a.createElement(fe.a,{icon:"bottom",color:Ge.a.coolGrey}))},Zt=function(e){return i.a.createElement(tt.a.Option,e,i.a.createElement("div",{className:pe()(ze.a["select-option"])},e.isSelected&&i.a.createElement(fe.a,{icon:"check-circleless",color:Ge.a.dodgerBlue}),i.a.createElement("div",null,i.a.createElement("div",{className:ze.a["select-option-label"]},e.label),i.a.createElement("div",{className:ze.a["select-option-desc"]},e.data.desc))))},Qt={option:function(e,t){return Yt({},e,{color:"black",backgroundColor:t.isFocused?Ge.a.paleGrey:null,padding:0,borderBottom:0===t.options.findIndex(function(e){return e.value===t.value})?"1px solid ".concat(Ge.a.silver):null})},menu:function(e){return Yt({},e,{width:"204%"})}},Xt=function(e){var t=e.options,n=e.onChange;return i.a.createElement("div",{className:ze.a["select-wrapper"]},i.a.createElement(nt.a,{name:"select",classNamePrefix:"needsclick react-select",components:{DropdownIndicator:Wt,Option:Zt},styles:Qt,defaultValue:t[0],isSearchable:!1,onChange:function(e){n(e.value)},options:t}))};Xt.propTypes={onChange:l.a.func,options:l.a.array.isRequired},Xt.defaultProps={onChange:Fe.a.log,value:""};var Jt=function(e){return i.a.createElement(de.a,{onClick:function(){e.onSubmit()},busy:e.loading,label:e.label,disabled:e.disabled})};Jt.propTypes={onSubmit:l.a.func.isRequired,label:l.a.string,loading:l.a.bool,disabled:l.a.bool},Jt.defaultProps={label:"Submit",loading:!1};var $t=function(e,t){return t.filter(function(t){var n=Ee.a.getPrimaryEmail(t),r=Ee.a.getPrimaryCozy(t);return!e.find(function(e){return n&&e.email&&e.email===n||r&&e.instance&&e.instance===r})}).length},en=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=Gt(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Bt(o)&&"function"!=typeof o?Vt(r):o,Kt(Vt(n),"sharingTypes",[{value:"two-way",label:n.context.t("Share.type.two-way"),desc:n.context.t("Share.type.desc.two-way"),disabled:!1},{value:"one-way",label:n.context.t("Share.type.one-way"),desc:n.context.t("Share.type.desc.one-way"),disabled:!1}]),Kt(Vt(n),"initialState",{recipients:[],sharingType:"two-way",loading:!1}),Kt(Vt(n),"state",Yt({},n.initialState)),Kt(Vt(n),"reset",function(){n.setState(Yt({},n.initialState))}),Kt(Vt(n),"onChange",function(e){n.setState(function(t){return Yt({},t,{sharingType:e})})}),Kt(Vt(n),"onSubmit",function(){n.sendSharingLink()}),Kt(Vt(n),"sanitizeRecipient",function(e){var t=e.email.match(/\s(.+@.+)\s/g);return e.email=t.length?t[0].trim().replace(/\s.+/g,"").replace(/^[\W]|[\W]$/g,""):e.email,e}),Kt(Vt(n),"onRecipientPick",function(e){var t;if(e._type===Ee.c.doctype){var r=e.id;t=n.props.contacts.data.filter(function(e){return d()(e,"relationships.groups.data",[]).map(function(e){return e._id}).includes(r)})}else t=[e];var o=t.filter(function(e){return e.email&&e.email.length>0||e.cozy&&e.cozy.length>0}).filter(function(e){return!n.state.recipients.find(function(t){return t===e})});n.setState(function(e){return Yt({},e,{recipients:[].concat(Ft(e.recipients),Ft(o))})})}),Kt(Vt(n),"onRecipientRemove",function(e){var t=n.state.recipients.findIndex(function(t){return t===e});n.setState(function(e){return Yt({},e,{recipients:[].concat(Ft(e.recipients.slice(0,t)),Ft(e.recipients.slice(t+1)))})})}),Kt(Vt(n),"getSuccessMessage",function(e){var t=n.props.documentType,r=n.state.recipients;if(1===r.length){var o=r[0],a=Ee.a.isContact(o)?Ee.a.getPrimaryEmail(o):o.email,i=Ee.a.getPrimaryCozy(o);return a?["".concat(t,".share.shareByEmail.success"),{email:a}]:i?["".concat(t,".share.shareByEmail.success"),{email:i}]:["".concat(t,".share.shareByEmail.genericSuccess"),{count:1}]}return["".concat(t,".share.shareByEmail.genericSuccess"),{count:$t(e,r)}]}),Kt(Vt(n),"share",function(){var e=n.props,t=e.document,r=e.sharingDesc,o=e.onShare,a=e.createContact,i=n.state,c=i.recipients,u=i.sharingType;if(0!==c.length){var s=n.props.currentRecipients;n.setState(function(e){return Yt({},e,{loading:!0})}),Promise.all(c.map(function(e){return e.id?e:a({email:[{address:e.email,primary:!0}]}).then(function(e){return e.data})})).then(function(e){return o(t,e,u,r)}).then(function(){Be.a.success.apply(Be.a,Ft(n.getSuccessMessage(s))),n.reset()}).catch(function(e){throw Be.a.error("Error.generic"),n.reset(),e})}}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this,t=this.context.t,n=this.props,r=n.contacts,o=n.documentType,a=n.groups,c=this.state.recipients;return i.a.createElement("div",{className:ze.a["coz-form-group"]},i.a.createElement("div",{className:ze.a["coz-form"]},i.a.createElement(Mt,{label:t("".concat(o,".share.shareByEmail.email")),placeholder:0===c.length?t("".concat(o,".share.shareByEmail.emailPlaceholder")):"",onFocus:this.onInputFocus,onPick:function(t){return e.onRecipientPick(t)},onRemove:function(t){return e.onRecipientRemove(t)},contacts:r,groups:a,recipients:c})),i.a.createElement("div",{className:ze.a["share-type-control"]},i.a.createElement(Xt,{options:this.sharingTypes,onChange:this.onChange}),i.a.createElement(Jt,{label:t("".concat(o,".share.shareByEmail.send")),onSubmit:this.share,loading:this.state.loading,disabled:0===c.length})))}}])&&Ut(n.prototype,r),o&&Ut(n,o),t}();Kt(en,"contextTypes",{t:l.a.func.isRequired,client:l.a.object.isRequired}),en.propTypes={currentRecipients:l.a.arrayOf(l.a.object),contacts:ke.isRequired,groups:je.isRequired,document:l.a.object.isRequired,documentType:l.a.string.isRequired,sharingDesc:l.a.string.isRequired,onShare:l.a.func.isRequired,createContact:l.a.func.isRequired};var tn=en,nn=n("zzwF"),rn=n("ufaa"),on=n("Tjnw"),an=n("UxX4"),cn=n("32XB"),un=n.n(cn);function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hn=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=pn(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==sn(o)&&"function"!=typeof o?fn(r):o,mn(fn(n),"state",{active:!1}),mn(fn(n),"toggle",function(){n.setState({active:!n.state.active})}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this,t=this.props,n=t.breakpoints.isMobile,r=t.children,o=t.text,a=t.buttonClassName,c=t.name;return n?i.a.createElement("div",null,i.a.createElement(on.a,{onClick:this.toggle,text:o,buttonClassName:a}),this.state.active&&i.a.createElement(an.a,{onClose:function(){return e.toggle()}},i.a.createElement(nn.a,{className:un.a["fil-mobileactionmenu"]},i.a.createElement(er,{name:c,size:"small"})),r)):i.a.createElement(nn.b,this.props)}}])&&ln(n.prototype,r),o&&ln(n,o),t}(),bn=Object(rn.a)()(hn),yn=n("OnOE"),vn=n.n(yn),gn=n("Bicm"),wn=n.n(gn);function _n(e){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function On(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function En(e,t){return!t||"object"!==_n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kn(e){return(kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jn(e,t){return(jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Sn(){return(Sn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var xn,Pn,Cn,An=function(e){return i.a.createElement(vn.a,Sn({place:"bottom",effect:"solid",className:wn.a["shared-tooltip"]},e),e.children)},Tn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),En(this,kn(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jn(e,t)}(t,i.a.Component),n=t,(r=[{key:"render",value:function(){var e=this.context.t,t=this.props,n=t.recipientNames,r=t.cutoff,o=void 0===r?4:r;return i.a.createElement("ul",{className:wn.a["shared-tooltip-list"]},n.slice(0,o).map(function(e){return i.a.createElement("li",{key:"key_name_".concat(e)},e)}),n.length>o&&i.a.createElement("li",null,e("Share.members.others",{smart_count:n.slice(o).length})))}}])&&On(n.prototype,r),o&&On(n,o),t}();xn=Tn,Pn="contextTypes",Cn={t:l.a.func.isRequired},Pn in xn?Object.defineProperty(xn,Pn,{value:Cn,enumerable:!0,configurable:!0,writable:!0}):xn[Pn]=Cn,Tn.propTypes={recipientNames:l.a.arrayOf(l.a.string),cutoff:l.a.number},Tn.defaultProps={recipientNames:[],cutoff:4};var Rn=function(){var e={base:["304FFE","2979FF","00B0FF","00DCE9","00D5B8","00C853","E70505","FF5700","FF7900","FFA300","B3C51D","64DD17","FF2828","F819AA","AA00FF","6200EA","7190AB","51658D"]},t=function(e){var t,n,r,o;for(t=0,o=Math.pow(2,32),n=0,r=e.length;n<r;n++)t=(31*t+e.charCodeAt(n))%o;return t};return{getHash:t,getColor:function(n,r){var o;return"#"+(o=e[r]||e.base)[t(n)%o.length]}}};function Nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zn=function(e){var t=e.text,n=e.size,r=e.textId,o=t.charAt(0),a={backgroundColor:Rn().getColor(r)};return i.a.createElement("div",{className:pe()(yt.a["recipient-avatar"],Nn({},yt.a["recipient-avatar--small"],"small"===n)),style:a,"data-tip":r,"data-for":"recipient-avatar-".concat(t)},i.a.createElement("span",null,o),i.a.createElement(An,{id:"recipient-avatar-".concat(t)}))};zn.propTypes={text:l.a.string,size:l.a.string,textId:l.a.string},zn.defaultProps={text:"",size:"small-plus",textId:""};var Ln=function(e){var t=e.size,n=e.extraRecipients,r=void 0===n?[]:n;return i.a.createElement("div",{className:pe()(yt.a["recipient-avatar"],Nn({},yt.a["recipient-avatar--small"],"small"===t)),"data-tip":!0,"data-for":"extra-recipients-avatar"},i.a.createElement("span",{className:yt.a["recipient-avatar-plusx"]},"+",Math.min(r.length,99)),i.a.createElement(An,{id:"extra-recipients-avatar"},i.a.createElement(Tn,{recipientNames:r})))};Ln.propTypes={extraRecipients:l.a.arrayOf(l.a.string),size:l.a.string},Ln.defaultProps={extraRecipients:[],size:"medium"};var Dn=new ut.a({id:"icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6",use:"icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6">\n    <defs>\n        <path d="M3.00247329,2 C2.45576096,2 2,1.55228475 2,1 C2,0.443864822 2.44882258,0 3.00247329,0 L12.9975267,0 C13.544239,0 14,0.44771525 14,1 C14,1.55613518 13.5511774,2 12.9975267,2 L13,2 L13,3 C13,3.55613518 12.6840146,4.31598541 12.2942268,4.70577316 L9,8 L12.2942268,11.2942268 C12.6840146,11.6840146 13,12.4438648 13,13 L13,14 L12.9975267,14 C13.5511774,14 14,14.4438648 14,15 C14,15.5522847 13.544239,16 12.9975267,16 L3.00247329,16 C2.44882258,16 2,15.5561352 2,15 C2,14.4477153 2.45576096,14 3.00247329,14 L3,14 L3,13 C3,12.4477153 3.31277239,11.6872276 3.70577316,11.2942268 L7,8 L3.70577316,4.70577316 C3.31277239,4.31277239 3,3.55228475 3,3 L3,2 L3.00247329,2 Z M4.5,3 C4.5,3.55228475 4.83559471,4.28765261 5.25944787,4.65095532 L8,7 L10.7405521,4.65095532 C11.1599836,4.29144262 11.5,3.54681396 11.5,3 L4.5,3 Z" id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n    </defs>\n    <g id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_ð¦-icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_icons/16/hourglass">\n            <mask id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_mask-2" fill="white">\n                <use xlink:href="#icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n            </mask>\n            <use id="icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-hourglass-16_4d32835335eff7a3974a2aa8cf422ff6_path-1" />\n        </g>\n    </g>\n</symbol>'}),qn=(lt.a.add(Dn),Dn),In=new ut.a({id:"icon-eye-16_32a783455d403df2cdd48aa32afb9d27",use:"icon-eye-16_32a783455d403df2cdd48aa32afb9d27-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27">\n    <defs>\n        <path d="M0,8 C0,8 2,2 8,2 C14,2 16,8 16,8 C16,8 14,14 8,14 C2,14 0,8 0,8 Z M8,12 C10.2091391,12 12,10.2091391 12,8 C12,5.79086089 10.2091391,4 8,4 C5.79086089,4 4,5.79086089 4,8 C4,10.2091391 5.79086089,12 8,12 Z M8,10 C6.89543045,10 6,9.10456955 6,8 C6,6.89543045 6.89543045,6 8,6 C9.10456955,6 10,6.89543045 10,8 C10,9.10456955 9.10456955,10 8,10 Z" id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n    </defs>\n    <g id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_icons/16/eye" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <mask id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_mask-2" fill="white">\n            <use xlink:href="#icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n        </mask>\n        <use id="icon-eye-16_32a783455d403df2cdd48aa32afb9d27_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-eye-16_32a783455d403df2cdd48aa32afb9d27_path-1" />\n    </g>\n</symbol>'}),Mn=(lt.a.add(In),In),Bn=new ut.a({id:"icon-pen-write-16_2d81809ca299a1197d20de636609807e",use:"icon-pen-write-16_2d81809ca299a1197d20de636609807e-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-pen-write-16_2d81809ca299a1197d20de636609807e">\n    <defs>\n        <path d="M9.5,3.50347728 L12.5,6.50347728 L3.03771973,16.0034773 L0,16.0034773 L0,13.0288679 L9.5,3.50347728 Z M14.9121541,0.915631358 L15.0878459,1.0913232 C15.8637772,1.86725444 15.8697383,3.14159072 15.0922712,3.92874355 L14.0307617,5.00347728 L11,2.00347728 L12.0892639,0.914213423 C12.8691444,0.13433284 14.1322429,0.135720196 14.9121541,0.915631358 Z M7,14.0034773 L12.9970707,14.0034773 C13.5509732,14.0034773 14,14.4473421 14,15.0034773 C14,15.555762 13.5536886,16.0034773 13.0024554,16.0034773 L5,16.0034773 L7,14.0034773 Z" id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n    </defs>\n    <g id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_icons/16/pen-write" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <mask id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_mask-2" fill="white">\n            <use xlink:href="#icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n        </mask>\n        <use id="icon-pen-write-16_2d81809ca299a1197d20de636609807e_Mask" fill="#95999d" fill-opacity="0.5" xlink:href="#icon-pen-write-16_2d81809ca299a1197d20de636609807e_path-1" />\n    </g>\n</symbol>'}),Fn=(lt.a.add(Bn),Bn),Un=new ut.a({id:"icon-trash-red_c64051db4812a1c5d58fc48b31781cbc",use:"icon-trash-red_c64051db4812a1c5d58fc48b31781cbc-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-trash-red_c64051db4812a1c5d58fc48b31781cbc">\n  <g fill="#F52D2D" fill-rule="evenodd" transform="translate(-96 -32)">\n    <path d="M100.5,33 L98.0068455,33 C97.4499488,33 97,33.4477153 97,34 L97,35 L111,35 L111,34 C111,33.4438648 110.54922,33 109.993155,33 L107.5,33 L107,32 L101,32 L100.5,33 Z M98,36 L110,36 L110,45.9914698 C110,47.1007504 109.09805,48 107.99147,48 L100.00853,48 C98.8992496,48 98,47.0980496 98,45.9914698 L98,36 Z" />\n    <path d="M100.5,33 L98.0068455,33 C97.4499488,33 97,33.4477153 97,34 L97,35 L111,35 L111,34 C111,33.4438648 110.54922,33 109.993155,33 L107.5,33 L107,32 L101,32 L100.5,33 Z M98,36 L110,36 L110,45.9914698 C110,47.1007504 109.09805,48 107.99147,48 L100.00853,48 C98.8992496,48 98,47.0980496 98,45.9914698 L98,36 Z" />\n  </g>\n</symbol>'}),Gn=(lt.a.add(Un),Un);function Vn(){return(Vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Hn(e){return(Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yn(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function Kn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Yn(a,r,o,i,c,"next",e)}function c(e){Yn(a,r,o,i,c,"throw",e)}i(void 0)})}}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zn(e){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xn(e,t){return(Xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jn(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function $n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var er=function(e){var t=e.url,n=e.size,r=Jn(e,["url","size"]);return i.a.createElement("div",{className:yt.a.avatar},i.a.createElement(zn,{text:Ee.a.getInitials(r),size:n,textId:Ee.a.getDisplayName(r)}),i.a.createElement(gt,{name:Ee.a.getDisplayName(r),details:t}))},tr=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];return r=this,a=(e=Zn(t)).call.apply(e,[this].concat(c)),n=!a||"object"!==Hn(a)&&"function"!=typeof a?Qn(r):a,$n(Qn(n),"state",{revoking:!1}),$n(Qn(n),"onRevoke",Kn(o.a.mark(function e(){var t,r,a,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.onRevoke,a=t.document,i=t.sharingId,c=t.index,n.setState({revoking:!0}),e.next=4,r(a,i,c);case 4:n.setState({revoking:!1});case 5:case"end":return e.stop()}},e)}))),$n(Qn(n),"getStatusIcon",function(e){switch(e){case"one-way":return Mn;case"two-way":return Fn;default:return qn}}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xn(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.isOwner,n=e.status,r=e.instance,o=e.type,a=e.documentType,c=e.name,u=this.context,s=u.t,l=u.client,p=this.state.revoking,f=void 0!==r&&r===l.options.uri&&!t,d=!p&&"owner"!==n&&(f||t);return i.a.createElement("div",{className:pe()(yt.a["recipient-status"],"u-ml-1")},p&&i.a.createElement(Me.b,null),!d&&i.a.createElement("span",{className:yt.a["recipient-owner"]},s("Share.status.".concat(n))),d&&i.a.createElement(bn,{text:s("ready"===n&&o?"Share.type.".concat(o):"Share.status.".concat(n)),className:yt.a["recipient-menu"],buttonClassName:yt.a["recipient-menu-btn"],position:"right",popover:!0,itemsStyle:{maxWidth:"280px"},name:c},i.a.createElement(nn.a,{icon:i.a.createElement(fe.a,{icon:this.getStatusIcon(n)})},s("ready"===n&&o?"Share.type.".concat(o):"Share.status.".concat(n))),i.a.createElement("hr",null),i.a.createElement(nn.a,{onSelect:this.onRevoke,onClick:this.onRevoke,icon:i.a.createElement(fe.a,{icon:Gn})},i.a.createElement("div",{className:yt.a["action-unshare"]},s("".concat(a,t?".share.revoke.title":".share.revokeSelf.title"))),i.a.createElement("p",{className:yt.a["action-unshare-desc"]},s("".concat(a,t?".share.revoke.desc":".share.revokeSelf.desc"))))))}}])&&Wn(n.prototype,r),c&&Wn(n,c),t}();$n(tr,"contextTypes",{t:l.a.func.isRequired,client:l.a.object.isRequired});var nr=Object(rn.a)()(tr),rr=function(e,t){var n=t.client,r=t.t,o=e.instance,a=e.isOwner,c=e.status,u=Jn(e,["instance","isOwner","status"]),s=a&&"owner"===c||o===n.options.uri,l=r("models.contact.defaultDisplayName"),p=l[0].toUpperCase(),f=Ee.a.getDisplayName(u,l);return i.a.createElement("div",{className:pe()(yt.a.recipient,"u-mt-1")},i.a.createElement(zn,{text:Ee.a.getInitials(u,p),size:"small-plus",textId:f}),i.a.createElement("div",{className:yt.a["recipient-ident-status"]},i.a.createElement(gt,{name:s?r("Share.recipients.you"):f,details:o}),i.a.createElement(nr,Vn({},e,{name:f}))))};rr.contextTypes={client:l.a.object.isRequired,t:l.a.func.isRequired};var or=rr,ar=function(e,t){var n=e.extraRecipients,r=t.t;return i.a.createElement("div",{className:yt.a.recipient},i.a.createElement(Ln,{extraRecipients:n.map(function(e){return Ee.a.getDisplayName(e)})}),i.a.createElement("div",{className:yt.a["recipient-ident-status"]},i.a.createElement(gt,{name:r("Share.members.otherContacts",n.length)})))};function ir(e){return(ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cr(){return(cr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sr(e,t){return!t||"object"!==ir(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lr(e){return(lr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pr(e,t){return(pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}ar.contextTypes={t:l.a.func.isRequired};var fr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),sr(this,lr(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pr(e,t)}(t,a["PureComponent"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.isOwner,n=void 0!==t&&t,r=e.recipients,o=e.document,a=e.documentType,c=e.onRevoke,u=e.className,s=this.context.t;return i.a.createElement("div",{className:u},r.length>1&&i.a.createElement(Ie.c,null,s("".concat(a,".share.whoHasAccess.title"),{smart_count:r.length})),r.map(function(e,t){return i.a.createElement(or,cr({},e,{key:"key_r_".concat(t),isOwner:n,document:o,documentType:a,onRevoke:c}))}))}}])&&ur(n.prototype,r),o&&ur(n,o),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(fr,"contextTypes",{t:l.a.func.isRequired});var dr=fr;function mr(e){return(mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function br(e,t){return!t||"object"!==mr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yr(e){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vr(e,t){return(vr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n("T1qB");var gr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),br(this,yr(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vr(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.context.t,t=this.props,n=t.document,r=t.isOwner,o=t.sharingDesc,a=t.contacts,c=t.groups,u=t.createContact,s=t.link,l=t.recipients,p=t.documentType,f=void 0===p?"Document":p,d=t.needsContactsPermission,m=t.hasSharedParent,h=t.hasSharedChild,b=t.onClose,y=t.onShare,v=t.onRevoke,g=t.onShareByLink,w=t.onRevokeLink;return i.a.createElement(Re.c,{title:e("".concat(f,".share.title")),dismissAction:b,into:"body",size:"small",spacing:"small",mobileFullscreen:!0},(m||h)&&i.a.createElement("div",{className:ze.a["share-byemail-onlybylink"]},e("".concat(f,".share.shareByEmail.onlyByLink"),{type:e("".concat(f,".share.shareByEmail.type.").concat("directory"===n.type?"folder":"file"))})," ",i.a.createElement("strong",null,e("".concat(f,".share.shareByEmail.").concat(m?"hasSharedParent":"hasSharedChild")))),i.a.createElement(Re.a,{className:pe()(ze.a["share-modal-content"],ze.a["share-moral-override-bottom"])},"Albums"!==f&&!m&&!h&&i.a.createElement(tn,{currentRecipients:l,document:n,documentType:f,sharingDesc:o,contacts:a,groups:c,createContact:u,onShare:y,needsContactsPermission:d}),i.a.createElement("div",{className:ze.a["share-modal-separator"]}),i.a.createElement("div",{className:ze.a["share-modal-secondary"]},i.a.createElement("div",{className:pe()(ze.a["share-modal-margins"],"u-pb-1")},i.a.createElement(et,{document:n,documentType:f,checked:null!==s,link:s,onEnable:g,onDisable:w}),"Albums"!==f&&i.a.createElement(dr,{className:"u-mt-1",isOwner:r,recipients:l,document:n,documentType:f,onRevoke:v})))))}}])&&hr(n.prototype,r),o&&hr(n,o),t}();function wr(){return(wr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _r(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(gr,"contextTypes",{t:l.a.func.isRequired}),gr.propTypes={document:l.a.object.isRequired,isOwner:l.a.bool,sharingDesc:l.a.string,contacts:ke.isRequired,groups:je.isRequired,createContact:l.a.func.isRequired,recipients:l.a.array.isRequired,link:l.a.string,documentType:l.a.string,needsContactsPermission:l.a.bool,hasSharedParent:l.a.bool,hasSharedChild:l.a.bool,onClose:l.a.func.isRequired,onShare:l.a.func.isRequired,onRevoke:l.a.func.isRequired,onShareByLink:l.a.func.isRequired,onRevokeLink:l.a.func.isRequired};var Or=function(e){var t=e.client,n=e.contacts,r=e.document,o=e.groups,a=_r(e,["client","contacts","document","groups"]);return i.a.createElement(Te,{contacts:n,groups:o},i.a.createElement(se.Consumer,null,function(e){var c=e.documentType,u=e.isOwner,s=e.getRecipients,l=e.getSharingLink,p=e.share,f=e.revoke,d=e.shareByLink,m=e.revokeSharingLink,h=e.hasSharedParent,b=e.hasSharedChild;return i.a.createElement(gr,wr({document:r,documentType:c,contacts:n,createContact:function(e){return t.create(Ee.a.doctype,e)},groups:o,recipients:s(r.id),link:l(r.id),isOwner:u(r.id),hasSharedParent:h(r),hasSharedChild:b(r),onShare:p,onRevoke:f,onShareByLink:d,onRevokeLink:m},a))}))};Or.propTypes={client:l.a.object.isRequired,document:l.a.object,contacts:ke.isRequired,groups:je.isRequired};var Er=Oe()(Object(u.queryConnect)({contacts:{query:function(e){return e.all(Ee.a.doctype).where({_id:{$gt:null},trashed:{$or:[{$eq:!1},{$exists:!1}]},$or:[{cozy:{$not:{$size:0}}},{email:{$not:{$size:0}}}]}).indexFields(["_id"])},as:"contacts"},groups:{query:function(e){return e.all(Ee.c.doctype)},as:"groups"}}),u.withClient)(Or);function kr(e){return(kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sr(e,t){return!t||"object"!==kr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pr(e,t){return(Pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Cr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Sr(this,xr(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pr(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.context,t=e.t,n=e.f,r=this.props,o=r.onClose,a=r.sharingType,c=r.owner,u=r.recipients,s=r.document,l=r.documentType,p=void 0===l?"Document":l,f=r.onRevoke;return i.a.createElement(Re.c,{title:t("".concat(p,".share.details.title")),secondaryAction:o,className:ze.a["share-modal"],into:"body",size:"small",mobileFullscreen:!0},i.a.createElement(Re.a,{className:ze.a["share-modal-content"]},i.a.createElement("div",{className:ze.a["share-details"]},i.a.createElement(er,{name:t("".concat(p,".share.sharedBy"),{name:Ee.a.getDisplayName(c)}),url:c.instance}),i.a.createElement("div",{className:ze.a["share-details-created"]},t("".concat(p,".share.details.createdAt"),{date:n(s.created_at||null,"Do MMMM YYYY")})),i.a.createElement("div",{className:ze.a["share-details-perm"]},t("".concat(p,".share.details.").concat("one-way"===a?"ro":"rw"))),i.a.createElement("div",{className:ze.a["share-details-perm-desc"]},t("".concat(p,".share.details.desc.").concat("one-way"===a?"ro":"rw")))),i.a.createElement("hr",{className:ze.a.divider}),i.a.createElement(dr,{title:t("Share.recipients.accessCount",{count:u.length}),recipients:u,document:s,documentType:p,onRevoke:f})))}}])&&jr(n.prototype,r),o&&jr(n,o),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Cr,"contextTypes",{t:l.a.func.isRequired,f:l.a.object.isRequired});var Ar=n("3Jea"),Tr=n.n(Ar),Rr=new ut.a({id:"icon-link_784d8d07b6c9bf8edf4207327b6add94",use:"icon-link_784d8d07b6c9bf8edf4207327b6add94-usage",viewBox:"0 0 16 16",content:'<symbol viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="icon-link_784d8d07b6c9bf8edf4207327b6add94">\n    <defs>\n        <path d="M8.87940867,3.87953579 C8.48888438,4.27006009 7.8557194,4.27006009 7.46519511,3.87953579 C7.07467081,3.4890115 7.07467081,2.85584652 7.46519511,2.46532223 L9.05304103,0.877476309 C10.2226142,-0.292096843 12.1218341,-0.292252339 13.289659,0.875572597 L14.4691583,2.05507187 C15.6394269,3.22534048 15.6355011,5.12344332 14.4628542,6.29609024 L10.9986358,9.7603087 C9.4643126,11.2946319 6.92867661,11.3430173 5.46519511,9.87953579 C5.07467081,9.4890115 5.07467081,8.85584652 5.46519511,8.46532223 C5.8557194,8.07479794 6.48888438,8.07479794 6.87940867,8.46532223 C7.54950929,9.13542285 8.81932532,9.11119201 9.5844222,8.34609513 L13.0486407,4.88187668 C13.4415455,4.48897179 13.4428522,3.85719292 13.0549447,3.46928543 L11.8754455,2.28978616 C11.488721,1.90306165 10.855831,1.90311347 10.4672546,2.29168987 L8.87940867,3.87953579 Z M6.46519511,11.4653222 C6.8557194,11.0747979 7.48888438,11.0747979 7.87940867,11.4653222 C8.26993296,11.8558465 8.26993296,12.4890115 7.87940867,12.8795358 L6.29156275,14.4673817 C5.12198959,15.6369549 3.22276968,15.6371104 2.05494474,14.4692854 L0.875445471,13.2897862 C-0.294823143,12.1195175 -0.290897366,10.2214147 0.881749556,9.04876778 L4.34596801,5.58454933 C5.88029117,4.05022616 8.41592716,4.00184073 9.87940867,5.46532223 C10.269933,5.85584652 10.269933,6.4890115 9.87940867,6.87953579 C9.48888438,7.27006009 8.8557194,7.27006009 8.46519511,6.87953579 C7.79509448,6.20943517 6.52527845,6.23366601 5.76018157,6.99876289 L2.29596312,10.4629813 C1.90305823,10.8558862 1.90175154,11.4876651 2.28965903,11.8755726 L3.4691583,13.0550719 C3.85588281,13.4417964 4.48877278,13.4417446 4.87734918,13.0531682 L6.46519511,11.4653222 Z" id="icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n    </defs>\n    <g id="icon-link_784d8d07b6c9bf8edf4207327b6add94_ð¦-icons" stroke="none" stroke-width="1" fill-rule="evenodd">\n        <g id="icon-link_784d8d07b6c9bf8edf4207327b6add94_icons/16/link">\n            <mask id="icon-link_784d8d07b6c9bf8edf4207327b6add94_mask-2">\n                <use xlink:href="#icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n            </mask>\n            <use id="icon-link_784d8d07b6c9bf8edf4207327b6add94_Mask" fill-rule="nonzero" xlink:href="#icon-link_784d8d07b6c9bf8edf4207327b6add94_path-1" />\n        </g>\n    </g>\n</symbol>'}),Nr=(lt.a.add(Rr),Rr);Object(ht.c)()(function(e){var t=e.className,n=e.docId,r=e.recipients,o=e.link,a=e.t;return i.a.createElement("span",{className:pe()(t,Tr.a["shared-status"])},r.length>1&&i.a.createElement("a",{"data-tip":!0,"data-for":"members".concat(n),className:Tr.a["shared-status-label"]},a("Share.members.count",{smart_count:r.length})),r.length>1&&i.a.createElement(An,{id:"members".concat(n)},i.a.createElement(Tn,{recipientNames:r.map(function(e){return Ee.a.getDisplayName(e)})})),o&&i.a.createElement(fe.a,{icon:Nr}))});function zr(){return(zr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Lr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Dr(e){return(Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ir(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Mr(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function Br(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Mr(a,r,o,i,c,"next",e)}function c(e){Mr(a,r,o,i,c,"throw",e)}i(void 0)})}}function Fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Yr(e,t,n[t])})}return e}function Ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gr(e){return(Gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hr(e,t){return(Hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kr=function(e){return function(e,t){var n=Object(p.b)();n&&n.push(["trackEvent",Wr(e)?"Drive":"Photos",t,"".concat(t).concat(Wr(e)?"File":"Album")])}(e,"shareByLink")},Wr=function(e){return"io.cozy.files"===e._type},Zr=function(e){function t(e,n){var r,a,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=Gr(t).call(this,e,n),r=!i||"object"!==Dr(i)&&"function"!=typeof i?Vr(a):i,Yr(Vr(r),"dispatch",function(e){return r.setState(function(t){return Fr({},t,M(t,e))})}),Yr(Vr(r),"getFilesPaths",function(){var e=Br(o.a.mark(function e(t){var n,a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return e.dir_id}).filter(function(e,t,n){return n.indexOf(e)===t}),e.next=3,r.context.client.collection(r.props.doctype).all({keys:n});case 3:return a=e.sent,i=t.map(function(e){var t=a.data.find(function(t){return t.id===e.dir_id}).path;return"/"===t?"/".concat(e.name):"".concat(t,"/").concat(e.name)}),e.abrupt("return",i);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Yr(Vr(r),"share",function(){var e=Br(o.a.mark(function e(t,n,a,i){var c,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c=K(r.state,t.id))){e.next=3;break}return e.abrupt("return",r.addRecipients(c,n,a));case 3:return e.next=5,r.context.client.collection("io.cozy.sharings").share(t,n,a,i,"/preview");case 5:if(u=e.sent,e.t0=r,e.t1=_,e.t2=u.data,e.t3=t.path,e.t3){e.next=14;break}return e.next=13,r.getFilesPaths([t]);case 13:e.t3=e.sent;case 14:return e.t4=e.t3,e.t5=(0,e.t1)(e.t2,e.t4),e.t0.dispatch.call(e.t0,e.t5),e.abrupt("return",u.data);case 18:case"end":return e.stop()}},e)}));return function(t,n,r,o){return e.apply(this,arguments)}}()),Yr(Vr(r),"addRecipients",function(){var e=Br(o.a.mark(function e(t,n,a){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.context.client.collection("io.cozy.sharings").addRecipients(t,n,a);case 2:i=e.sent,r.dispatch(O(i.data));case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),Yr(Vr(r),"revoke",function(){var e=Br(o.a.mark(function e(t,n,a){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Z(r.state,n),e.next=3,r.context.client.collection("io.cozy.sharings").revokeRecipient(i,a);case 3:if(e.t0=r,e.t1=E,e.t2=i,e.t3=a,e.t4=t.path,e.t4){e.next=12;break}return e.next=11,r.getFilesPaths([t]);case 11:e.t4=e.sent;case 12:e.t5=e.t4,e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.t0.dispatch.call(e.t0,e.t6);case 15:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()),Yr(Vr(r),"revokeSelf",function(){var e=Br(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=H(r.state,t.id),e.next=3,r.context.client.collection("io.cozy.sharings").revokeSelf(n);case 3:r.dispatch(k(n));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Yr(Vr(r),"shareByLink",function(){var e=Br(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Kr(t),e.next=3,r.context.client.collection("io.cozy.permissions").createSharingLink(t);case 3:return n=e.sent,r.dispatch(j(n.data)),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Yr(Vr(r),"revokeSharingLink",function(){var e=Br(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Q(r.state,t.id),e.next=3,Promise.all(n.map(function(e){return r.context.client.collection("io.cozy.permissions").destroy(e)}));case 3:r.dispatch(S(n));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());var c=r.context.client.options.uri,u=e.documentType||"Document";return r.state={byDocId:{},sharings:[],permissions:[],sharedFolderPaths:[],documentType:u,isOwner:function(e){return B(r.state,e)},canReshare:function(e){return F(r.state,e,c)},getOwner:function(e){return U(r.state,e)},getSharingType:function(e){return Y(r.state,e,c)},getRecipients:function(e){return G(r.state,e)},getSharingLink:function(e){return V(r.state,e,u)},hasSharedParent:function(e){return J(r.state,e)},hasSharedChild:function(e){return $(r.state,e)},share:r.share,revoke:r.revoke,revokeSelf:r.revokeSelf,shareByLink:r.shareByLink,revokeSharingLink:r.revokeSharingLink},r}var n,r,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hr(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidMount",value:(u=Br(o.a.mark(function e(){var t,n,r,a,i,c,u,s,l,p,f;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.context.client,n=this.props.doctype,e.next=4,Promise.all([t.collection("io.cozy.sharings").findByDoctype(n),t.collection("io.cozy.permissions").findLinksByDoctype(n),t.collection("io.cozy.permissions").findApps()]);case 4:if(r=e.sent,a=Ir(r,3),i=a[0],c=a[1],u=a[2],this.dispatch(w({instanceUri:t.options.uri,sharings:i.data,permissions:c.data,apps:u.data})),"io.cozy.files"===n){e.next=12;break}return e.abrupt("return");case 12:return s=i.data.map(function(e){return te(e)}).reduce(function(e,t){return e.concat(t)},[]),e.next=15,t.collection(n).all({keys:s});case 15:return l=e.sent,p=l.data.filter(function(e){return"directory"===e.type}).map(function(e){return e.path}),e.next=19,this.getFilesPaths(l.data.filter(function(e){return"directory"!==e.type}));case 19:f=e.sent,this.dispatch({type:"RECEIVE_PATHS",paths:[].concat(qr(p),qr(f))});case 21:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"render",value:function(){return i.a.createElement(se.Provider,{value:Fr({},this.state)},this.props.children)}}])&&Ur(n.prototype,r),c&&Ur(n,c),t}();Yr(Zr,"contextTypes",{client:l.a.object.isRequired});var Qr=function(e,t){var n=t.t,r=e.docId,o=Lr(e,["docId"]);return i.a.createElement(se.Consumer,null,function(e){var t=e.byDocId,a=e.documentType,c=e.isOwner;return t[r]?c(r)?i.a.createElement(ve,zr({label:n("".concat(a,".share.sharedByMe"))},o)):i.a.createElement(ge,zr({label:n("".concat(a,".share.sharedWithMe"))},o)):i.a.createElement(we,zr({label:n("".concat(a,".share.cta"))},o))})};Qr.contextTypes={t:l.a.func.isRequired};var Xr=function(e){var t=e.document,n=Lr(e,["document"]);return i.a.createElement(se.Consumer,null,function(e){var r=e.documentType,o=e.getOwner,a=e.getSharingType,c=e.getRecipients,u=e.revokeSelf;return i.a.createElement(Cr,zr({document:t,documentType:r,owner:o(t.id),sharingType:a(t.id),recipients:c(t.id),onRevoke:u},n))})},Jr=function(e){var t=e.document,n=Lr(e,["document"]);return i.a.createElement(se.Consumer,null,function(e){var r=e.byDocId,o=e.isOwner,a=e.canReshare;return!r[t.id]||o(t.id)||a(t.id)?i.a.createElement(Er,zr({document:t},n)):i.a.createElement(Xr,zr({document:t},n))})},$r=n("0yyf"),eo=n.n($r),to=n("SvPG"),no=n("t0Aa"),ro=n.n(no),oo=Object(c.f)(function(e){var t=e.t,n=e.router;return i.a.createElement("div",{"data-test-id":"pho-toolbar-albums",className:ro.a["pho-toolbar"],role:"toolbar"},i.a.createElement("div",{className:ro.a["u-hide--mob"]},i.a.createElement(de.b,{"data-test-id":"album-add",theme:"secondary",href:"#/albums/new",icon:"album-add",label:t("Toolbar.album_new")})),i.a.createElement(nn.b,{className:pe()(ro.a["pho-toolbar-menu"],ro.a["u-hide--desk"]),component:i.a.createElement(to.b,null),position:"right"},i.a.createElement(nn.a,{onSelect:function(){return n.push("/albums/new")},icon:i.a.createElement(fe.a,{icon:"album-add"})},t("Toolbar.album_new"))))}),ao=n("6qED"),io=n.n(ao),co=n("jDpt"),uo=n("KOJc"),so=n("RPnM"),lo=n("510Z");function po(e){return(po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mo(e,t){return!t||"object"!==po(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ho(e){return(ho=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bo(e,t){return(bo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yo=Object(c.f)(function(e){var t=e.router,n=e.album,r=e.image,o=e.title,a=e.desc,u=t.location.pathname;return i.a.createElement(c.a,{to:"".concat(u,"/").concat(n._id),className:io.a["pho-album-link"]},r,o,a)}),vo=function(e){var t=e.album,n=e.image,r=e.title,o=e.desc,a=e.onClick;return e.disabled?i.a.createElement("div",{className:pe()(io.a["pho-album-link"],io.a["pho-album-link--disabled"])},n,i.a.createElement("div",null,r,o)):i.a.createElement("div",{onClick:function(){return a(t)},className:io.a["pho-album-link"]},n,i.a.createElement("div",null,r,o))},go=Object(ht.c)()(function(e){var t=e.t,n=e.photoCount,r=e.shared,o=void 0===r?{}:r;return i.a.createElement("h4",{className:io.a["pho-album-description"]},t("Albums.album_item_description",{smart_count:n}),(o.byMe||o.withMe)&&" - ".concat(t("Albums.album_item_shared_".concat("one-way"===o.sharingType?"ro":"rw"))))}),wo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),mo(this,ho(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bo(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.album,r=e.shared,o=void 0===r?{}:r,a=e.onClick,c=e.thumbnail,u=o.readOnly,s=n.photos.data[0]||null,l=s?i.a.createElement(lo.a,{file:s,size:"small",render:function(e){return i.a.createElement("img",{src:e,className:io.a["pho-album-photo-item"],alt:"".concat(n.name," album cover")})}}):i.a.createElement("div",{className:io.a["pho-album-photo-item"]}),p=i.a.createElement(go,{t:t,album:n,shared:o,thumbnail:c,photoCount:n.photos.count}),f=i.a.createElement("h2",{className:io.a["pho-album-title"]},n.name);return i.a.createElement("div",{"data-test-id":"pho-album","data-test-name":n.name,className:io.a["pho-album"]},a?i.a.createElement(vo,{album:n,image:l,title:f,desc:p,onClick:a,disabled:u}):i.a.createElement(yo,{album:n,image:l,title:f,desc:p}))}}])&&fo(n.prototype,r),o&&fo(n,o),t}(),_o=function(e,t){return new Date(t.created_at||null)-new Date(e.created_at||null)},Oo=Object(ht.c)()(function(e){var t=e.data,n=e.hasMore,r=e.fetchMore,o=e.t;return 0===t.length?i.a.createElement(uo.a,{localeKey:"albums"}):i.a.createElement(co.a,null,i.a.createElement("div",{className:io.a["pho-album-list"]},t.sort(_o).map(function(e){return i.a.createElement(wo,{album:e,key:e.id})}),n&&i.a.createElement(so.a,{label:o("Albums.load_more"),onClick:r})))}),Eo=n("ZFPb"),ko=n("SvWF"),jo=n("eKCf");function So(e){return(So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Po(e,t){return!t||"object"!==So(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Co(e){return(Co=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ao(e,t){return(Ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var To=function(e){var t=e.list;switch(t.fetchStatus){case"pending":case"loading":return i.a.createElement(Eo.a,{loadingType:"albums_fetching"});case"failed":return i.a.createElement(ko.a,{errorType:"albums"});default:return i.a.createElement(Oo,t)}},Ro=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Po(this,Co(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ao(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props.t;return this.props.children?this.props.children:this.props.albums?i.a.createElement("div",{"data-test-id":"album-pho-content-wrapper",className:eo.a["pho-content-wrapper"]},i.a.createElement(jo.a,{viewName:"albums"},i.a.createElement(oo,{t:e})),i.a.createElement(To,{list:this.props.albums})):null}}])&&xo(n.prototype,r),o&&xo(n,o),t}(),No=Object(ht.c)()(Ro),zo=n("/MKj"),Lo=n("Yo2A"),Do=n("DbnX");function qo(e){return(qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Io(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mo(e,t){return!t||"object"!==qo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bo(e){return(Bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fo(e,t){return(Fo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Uo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Mo(this,Bo(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fo(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.router,r=e.album,o=e.sharedWithMe,a=e.readOnly,c=e.disabled,u=void 0!==c&&c,s=e.downloadAlbum,l=e.deleteAlbum,p=e.selectItems,f=e.onRename,d=e.breakpoints.isMobile,m=e.shareAlbum;return i.a.createElement("div",{"data-test-id":"pho-toolbar-album",className:ro.a["pho-toolbar"],role:"toolbar"},!d&&i.a.createElement(Qr,{disabled:u,label:t("Albums.share.cta"),onClick:function(){return m(r)}}),i.a.createElement(nn.b,{"data-test-id":"more-button",disabled:u,className:ro.a["pho-toolbar-menu"],component:i.a.createElement(to.b,null),position:"right"},!o&&i.a.createElement(nn.a,{className:ro.a["u-hide--desk"],icon:i.a.createElement(fe.a,{icon:"share"}),onSelect:function(){return m(r)}},t("Albums.share.cta")),i.a.createElement(nn.a,{"data-test-id":"menu-download-album",onSelect:s,icon:i.a.createElement(fe.a,{icon:"download"})},t("Toolbar.menu.download_album")),i.a.createElement(nn.a,{"data-test-id":"menu-rename-album",icon:i.a.createElement(fe.a,{icon:"rename"}),onSelect:f},t("Toolbar.menu.rename_album")),!a&&i.a.createElement(nn.a,{"data-test-id":"menu-add-photos-to-album",icon:i.a.createElement(fe.a,{icon:"album-add"}),onSelect:function(){return n.push("".concat(n.location.pathname,"/edit"))}},t("Toolbar.menu.add_photos")),i.a.createElement("hr",{className:ro.a["u-hide--desk"]}),i.a.createElement(nn.a,{className:ro.a["u-hide--desk"],icon:i.a.createElement(fe.a,{icon:Do.a}),onSelect:p},t("Toolbar.menu.select_items")),i.a.createElement("hr",null),!o&&i.a.createElement(nn.a,{"data-test-id":"menu-delete-album",className:ro.a["pho-action-delete"],icon:i.a.createElement(fe.a,{icon:"delete"}),onSelect:l},t("Toolbar.menu.album_delete"))))}}])&&Io(n.prototype,r),o&&Io(n,o),t}(),Go=Object(rn.a)()(Uo),Vo=n("TtgU"),Ho=n("2sk9"),Yo=n.n(Ho),Ko=function(e){var t=e.t,n=e.confirm,r=e.abort,o=["forbidden","eye","link"].map(function(e){return i.a.createElement("p",{className:pe()(Yo.a["fil-confirm-text"],Yo.a["icon-".concat(e)]),key:e},t("destroyconfirmation.".concat(e)))});return i.a.createElement(Re.c,{title:t("destroyconfirmation.title"),description:o,secondaryType:"secondary",secondaryText:t("destroyconfirmation.cancel"),secondaryAction:r,primaryType:"danger",primaryText:t("destroyconfirmation.delete"),primaryAction:n})},Wo=function(e){var t=e.t,n=e.confirm,r=e.abort,o=["forbidden"].map(function(e){return i.a.createElement("p",{key:"key_quit_".concat(e),className:pe()(Yo.a["fil-confirm-text"],Yo.a["icon-".concat(e)])},t("quitconfirmation.".concat(e)))});return i.a.createElement(Re.c,{title:t("quitconfirmation.title"),description:o,secondaryType:"secondary",secondaryText:t("quitconfirmation.cancel"),secondaryAction:r,primaryType:"danger",primaryText:t("quitconfirmation.quit"),primaryAction:n})},Zo=n("5wWc"),Qo=n("q/Uw");function Xo(e){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jo(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function $o(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Jo(a,r,o,i,c,"next",e)}function c(e){Jo(a,r,o,i,c,"throw",e)}i(void 0)})}}function ea(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){aa(e,t,n[t])})}return e}function ta(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function na(e){return(na=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ra(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oa(e,t){return(oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function aa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ia=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,u=new Array(c),s=0;s<c;s++)u[s]=arguments[s];return r=this,a=(e=na(t)).call.apply(e,[this].concat(u)),n=!a||"object"!==Xo(a)&&"function"!=typeof a?ra(r):a,aa(ra(n),"state",{editing:!1,showAddAlbumModal:!1}),aa(ra(n),"showAddAlbumModal",function(){n.setState(function(e){return ea({},e,{showAddAlbumModal:!0})})}),aa(ra(n),"hideAddAlbumModal",function(){n.setState(function(e){return ea({},e,{showAddAlbumModal:!1})})}),aa(ra(n),"editAlbumName",function(){n.setState(function(e){return ea({},e,{editing:!0})})}),aa(ra(n),"renameAlbum",function(e){if(""!==e.trim())if(e!==n.props.album.name){var t=ea({},n.props.album,{name:e});n.props.updateAlbum(t).then(function(){n.setState({editing:!1})}).catch(function(){Be.a.error("Error.generic")})}else n.setState({editing:!1});else Be.a.error("Error.album_rename_abort")}),aa(ra(n),"downloadAlbum",$o(o.a.mark(function e(){var t,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.album,e.next=3,n.context.client.getStackClient().collection("io.cozy.files").findReferencedBy({_type:"io.cozy.photos.albums",_id:t.id},{limit:99999});case 3:r=e.sent,n.context.client.collection("io.cozy.files").downloadArchive(r.data.map(function(e){return e._id}),t.name);case 5:case"end":return e.stop()}},e)}))),aa(ra(n),"downloadPhotos",function(e){n.context.client.collection("io.cozy.files").downloadArchive(e.map(function(e){return e._id}),"selected")}),aa(ra(n),"deleteAlbum",function(){var e=n.props,t=e.t,r=e.router,o=e.album,a=e.deleteAlbum;return Object(Zo.a)(i.a.createElement(Ko,{t:t,albumName:o.name}),function(){return a(o).then(function(){r.replace("albums"),Be.a.success("Albums.remove_album.success",{name:o.name})}).catch(function(){return Be.a.error("Albums.remove_album.error.generic")})})}),aa(ra(n),"leaveAlbum",function(){var e=n.props,t=e.t,r=e.router,o=e.album,a=e.deleteAlbum,c=e.leaveAlbum;return Object(Zo.a)(i.a.createElement(Wo,{t:t,albumName:o.name}),function(){return c(o).then(function(){return a(o)}).then(function(){r.replace("albums"),Be.a.success("Albums.quit_album.success",{name:o.name})}).catch(function(){return Be.a.error("Albums.quit_album.error.generic")})})}),n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oa(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this;if(!this.props.album||!this.props.photos)return null;var t=this.props,n=t.t,r=t.router,o=t.album,a=t.shareAlbum,c=t.photos,u=t.hasMore,s=t.fetchMore,l=this.state.editing,p={};return i.a.createElement(Qo.a,{actions:function(t){return{"album-add":e.showAddAlbumModal,download:e.downloadPhotos,"album-remove":function(n){return e.props.removePhotos(o,n,t.clear)}}}},function(t,f,d){return i.a.createElement("div",{"data-test-id":"album-pho-content-wrapper",className:eo.a["pho-content-wrapper"]},o.name&&o.photos.data&&i.a.createElement(jo.a,{viewName:"albumContent",albumName:o.name,editing:l,onEdit:e.renameAlbum},i.a.createElement(Go,{t:n,router:r,album:o,sharedWithMe:p.withMe,sharedByMe:p.byMe,readOnly:p.readOnly,onRename:e.editAlbumName,downloadAlbum:e.downloadAlbum,deleteAlbum:e.deleteAlbum,leaveAlbum:e.leaveAlbum,shareAlbum:a})),e.state.showAddAlbumModal&&i.a.createElement(ei,{onDismiss:e.hideAddAlbumModal,onSuccess:d.clear,photos:t}),c&&i.a.createElement(Vo.a,{lists:[{photos:c}],selected:t,photosContext:"timeline",showSelection:f,onPhotoToggle:d.toggle,onPhotosSelect:d.select,onPhotosUnselect:d.unselect,fetchStatus:c.fetchStatus,hasMore:u,fetchMore:s}),e.renderViewer(e.props.children),i.a.createElement(Lo.a,null))})}},{key:"renderViewer",value:function(e){var t=this;return e?i.a.Children.map(e,function(e){return i.a.cloneElement(e,{photos:t.props.photos})}):null}},{key:"componentWillUnmount",value:function(){void 0!==this.props.selection&&this.props.selection.clear()}}])&&ta(n.prototype,r),c&&ta(n,c),t}();aa(ia,"contextTypes",{client:l.a.object.isRequired});ia.propTypes={hasMore:l.a.bool.isRequired,fetchMore:l.a.func.isRequired,album:l.a.object.isRequired,shareAlbum:l.a.func,photos:l.a.array.isRequired,t:l.a.func.isRequired,router:l.a.object.isRequired};var ca=Oe()(Object(zo.connect)(null,function(e){return{shareAlbum:function(t){return e(Object(Lo.d)(i.a.createElement(Jr,{document:t,sharingDesc:t.name})))}}}),c.f,Object(ht.c)())(ia),ua=n("2lpW"),sa=n("C/eS"),la=n.n(sa);function pa(e){return(pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function da(e){return(da=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ma(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ha(e,t){return(ha=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ba(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ya=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=da(t).call(this,e),n=!o||"object"!==pa(o)&&"function"!=typeof o?ma(r):o,ba(ma(n),"onNameChange",function(e){n.setState({name:e.target.value})}),ba(ma(n),"onCancel",function(){n.props.router.goBack()}),ba(ma(n),"onCreate",function(e){var t=n.state.name;n.props.createAlbum(t,e).then(function(e){return n.props.router.push("/albums/".concat(e.id))}).catch(function(){n.input.focus(),n.input.select()})}),ba(ma(n),"onUpdate",function(e){var t=n.props.album;n.props.addPhotos(t,e).then(function(){return n.props.router.push("/albums/".concat(t.id))})}),n.state={name:e.t("Albums.create.panel_form.placeholder")},n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ha(e,t)}(t,a["Component"]),n=t,(r=[{key:"componentDidMount",value:function(){this.props.album||(this.input.focus(),this.input.select())}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.album,o=this.state.name,a=!r;return i.a.createElement(Qo.a,null,function(t,c,u){return i.a.createElement("div",{className:la.a["pho-panel"]},i.a.createElement("div",{className:la.a["pho-panel-form"]},i.a.createElement("header",{className:la.a["pho-panel-header"]},i.a.createElement("div",{className:la.a["pho-panel-wrap"]},a&&i.a.createElement("div",null,i.a.createElement("label",{className:la.a["coz-form-label"]},n("Albums.create.panel_form.label")),i.a.createElement("input",{"data-test-id":"input-album-name",type:"text",ref:function(t){e.input=t},value:o,onChange:e.onNameChange})),!a&&i.a.createElement("h3",{"data-test-id":"pho-picker-album-name"},r.name))),i.a.createElement("div",{className:la.a["pho-panel-content"]},i.a.createElement("div",{"data-test-id":"picker-panel",className:la.a["pho-panel-wrap"]},i.a.createElement(ua.a,{selected:t,showSelection:!0,selection:u}))),i.a.createElement("footer",{className:la.a["pho-panel-footer"]},i.a.createElement("div",{className:la.a["pho-panel-wrap"]},i.a.createElement("div",{className:la.a["pho-panel-controls"]},i.a.createElement(de.a,{theme:"secondary",onClick:e.onCancel,label:n("Albums.create.panel_form.cancel")}),i.a.createElement(de.a,{"data-test-id":"validate-album",onClick:function(){return a?e.onCreate(t):e.onUpdate(t)},label:n(a?"Albums.create.panel_form.submit":"Albums.create.panel_form.update")}))))))})}}])&&fa(n.prototype,r),o&&fa(n,o),t}(),va=Object(ht.c)()(Object(c.f)(ya)),ga=n("D575"),wa=n.n(ga),_a=n("luXY"),Oa=n.n(_a);function Ea(e){return(Ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ka(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ja(e,t){return!t||"object"!==Ea(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sa(e){return(Sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xa(e,t){return(xa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pa=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ja(this,Sa(t).call(this))).state={name:"",isSubmitDisabled:!0,isBusy:!1,hasError:!1},e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xa(e,t)}(t,a["Component"]),n=t,(r=[{key:"reset",value:function(){this.setState({name:"",isSubmitDisabled:!0,isBusy:!1,hasError:!1})}},{key:"onSubmit",value:function(e,t){var n=this;return e.preventDefault(),this.setState({isBusy:!0}),t(this.state.name).then(function(){return n.reset()},function(){return n.setState({hasError:!0,isBusy:!1})})}},{key:"onNameChange",value:function(e){var t=e.target.value;this.setState({name:t,isSubmitDisabled:!t.trim().length,hasError:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.onSubmitNewAlbum;return i.a.createElement("form",{className:Oa.a["pho-create-album-form"],onSubmit:function(t){return e.onSubmit(t,r)}},i.a.createElement("label",{className:Oa.a["coz-create-album-label"]},n("Albums.create.inline_form.create_label")),i.a.createElement("div",{className:Oa.a["coz-inline-form"]},i.a.createElement("input",{className:pe()(Oa.a["coz-input-text"],this.state.hasError&&Oa.a.error),type:"text",name:"album-name",onInput:function(t){return e.onNameChange(t)},disabled:this.state.isBusy,placeholder:n("Albums.create.inline_form.placeholder"),value:this.state.name}),i.a.createElement(de.a,{className:Oa.a["create-button"],disabled:this.state.isSubmitDisabled||this.state.isBusy,"aria-busy":this.state.isBusy,label:n("Albums.create.inline_form.create_button")})))}}])&&ka(n.prototype,r),o&&ka(n,o),t}(),Ca=Object(ht.c)()(Pa),Aa=void 0;function Ta(){return(Ta=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Ra=function(e){return 0===e.albums.data.length?i.a.createElement(uo.a,{localeKey:"albums"}):i.a.createElement("div",{className:pe()(io.a["pho-album-list"],io.a["pho-album-list--thumbnails"],io.a["pho-album-list--selectable"])},e.albums.data.map(function(t){return i.a.createElement(wo,{album:t,key:t.id,thumbnail:!0,onServerError:e.onServerError,onClick:e.onSubmitSelectedAlbum})}))},Na=Object(ko.b)(function(e){return e.error},"albums",function(e){return i.a.createElement("div",null,i.a.createElement(Ra,e))}),za=function(e){if(!e.albums)return null;var t="failed"===e.albums.fetchStatus;return i.a.createElement(Na,Ta({error:t,onServerError:function(){return Aa.handleError(t)}},e))};function La(e){return(La="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Da(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qa(e,t){return!t||"object"!==La(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ia(e){return(Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ma(e,t){return(Ma=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ba=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qa(this,Ia(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ma(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.photos,r=e.data,o=e.fetchStatus,a=e.createAlbum,c=e.addPhotos,u=e.onDismiss,s=e.onSuccess,l=void 0===s?function(){}:s,p="pending"===o||"loading"===o;return i.a.createElement(Re.c,{title:t("Albums.add_photos.title"),secondaryAction:u},i.a.createElement(Re.b,{className:wa.a["coz-modal-section"]},i.a.createElement("div",{className:pe()(wa.a["coz-create-album"])},i.a.createElement(Ca,{onSubmitNewAlbum:function(e){return a(e,n).then(u).then(l)}})),p?i.a.createElement(Eo.a,{loadingType:"albums_fetching"}):r&&r.length>0?i.a.createElement("div",{className:pe()(wa.a["coz-select-album"])},i.a.createElement(za,{albums:{data:r,fetchStatus:o},onSubmitSelectedAlbum:function(e){return c(e,n).then(u).then(l)}})):null))}}])&&Da(n.prototype,r),o&&Da(n,o),t}(),Fa=Object(ht.c)()(Ba),Ua=n("z6Q1");function Ga(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Va(){return(Va=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ha(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ya(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function Ka(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ya(a,r,o,i,c,"next",e)}function c(e){Ya(a,r,o,i,c,"throw",e)}i(void 0)})}}n.d(t,"a",function(){return Za}),n.d(t,"d",function(){return $a}),n.d(t,"e",function(){return ri}),n.d(t,"c",function(){return ti}),n.d(t,"b",function(){return ei}),n.d(t,"f",function(){return oi});var Wa=function(e){return e.find(Ua.a,{created_at:{$gt:null}}).where({auto:{$exists:!1}}).indexFields(["created_at"]).include(["photos"]).sortBy([{created_at:"desc"}])},Za=function(e,t){return e.get(Ua.a,t.router.params.albumId).include(["photos"])},Qa=function(){var e=Ka(o.a.mark(function e(t,n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.photos.data.length,e.next=4,t.photos.addById(n.map(function(e){return e._id}));case 4:a=t.photos.data.length,r+n.length!==a?Be.a.info("Alerter.photos.already_added_photo"):Be.a.success("Albums.add_photos.success",{name:t.name,smart_count:n.length}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),Be.a.error("Albums.add_photos.error.reference");case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,n){return e.apply(this,arguments)}}(),Xa=function(e){return{updateAlbum:(n=Ka(o.a.mark(function t(n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.collection(Ua.a).checkUniquenessOf("name",n.name);case 2:if(!0===t.sent){t.next=8;break}return Be.a.error("Albums.create.error.already_exists",{name:name}),t.abrupt("return");case 8:return t.abrupt("return",e.save(n));case 9:case"end":return t.stop()}},t)})),function(e){return n.apply(this,arguments)}),deleteAlbum:function(t){return e.destroy(t)},addPhotos:Qa,removePhotos:(t=Ka(o.a.mark(function e(t,n,r){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.photos.removeById(n.map(function(e){return e._id}));case 3:Be.a.success("Albums.remove_photos.success",{album_name:t.name}),r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Be.a.error("Albums.remove_photos.error.generic");case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,n,r){return t.apply(this,arguments)})};var t,n},Ja=function(e){return{addPhotos:Qa,createAlbum:(t=Ka(o.a.mark(function t(n,r){var a,i,c,u=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:new Date,t.prev=1,n){t.next=5;break}return Be.a.error("Albums.create.error.name_missing"),t.abrupt("return");case 5:return i={_type:Ua.a,name:n,created_at:a},t.next=8,e.collection(Ua.a).checkUniquenessOf("name",i.name);case 8:if(!0===t.sent){t.next=12;break}return Be.a.error("Albums.create.error.already_exists",{name:n}),t.abrupt("return");case 12:return t.next=14,e.create(Ua.a,i,{photos:r},{updateQueries:{albums:function(e,t){return[t.data].concat(Ha(e))}}});case 14:return c=t.sent,Be.a.success("Albums.create.success",{name:i.name,smart_count:r.length}),t.abrupt("return",c.data);case 19:t.prev=19,t.t0=t.catch(1),Be.a.error("Albums.create.error.generic");case 22:case"end":return t.stop()}},t,null,[[1,19]])})),function(e,n){return t.apply(this,arguments)})};var t},$a=function(e){return i.a.createElement(Zr,{doctype:Ua.a,documentType:"Albums"},i.a.createElement(u.Query,{query:Wa},function(t){return i.a.createElement(No,Va({albums:t},e))}))},ei=function(e){return i.a.createElement(u.Query,{query:Wa,as:"albums",mutations:Ja},function(t,n){var r=n.createAlbum,o=n.addPhotos;return i.a.createElement(Fa,Va({},t,{createAlbum:r,addPhotos:o},e))})},ti=Object(c.f)(function(e){return i.a.createElement(u.Query,Va({query:Za},e,{mutations:Xa}),(t={children:e.children},n=t.children,function(e,t){var r=e.data,o=e.fetchStatus,a=t.updateAlbum,c=t.deleteAlbum,u=t.removePhotos;return r&&"loaded"===o?i.a.createElement(ca,{album:r,photos:r.photos.data,updateAlbum:a,deleteAlbum:c,removePhotos:u,hasMore:r.photos.hasMore,fetchMore:r.photos.fetchMore.bind(r.photos)},n):i.a.createElement(Eo.a,{size:"xxlarge",loadingType:"photos_fetching",middle:!0})}));var t,n}),ni=Object(u.withMutations)(Ja)(va),ri=Object(c.f)(function(e){var t=e.params,n=Ga(e,["params"]);return t.albumId?i.a.createElement(u.Query,Va({query:Za,mutations:Ja},n),function(e,t){var n=e.data,r=t.addPhotos;return i.a.createElement(va,{album:n,addPhotos:r})}):i.a.createElement(ni,null)}),oi=function(e){if(!e)return!1;var t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;if(i.relationships&&i.relationships.referenced_by&&i.relationships.referenced_by.data&&i.relationships.referenced_by.data.length>0){var c=i.relationships.referenced_by.data,u=!0,s=!1,l=void 0;try{for(var p,f=c[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){if(p.value.type===Ua.a)return!0}}catch(d){s=!0,l=d}finally{try{u||null==f.return||f.return()}finally{if(s)throw l}}}}}catch(d){n=!0,r=d}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return!1}},SvPG:function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("buk/"),i=n("KXWi"),c=n("swni"),u=n.n(c),s=Object(a.c)()(function(e){var t=e.t,n=e.disabled,r=e.onClick;return o.a.createElement(i.a,{"data-test-id":"more-button",className:u.a["dri-btn--more"],theme:"secondary",disabled:n,onClick:r,extension:"narrow",icon:"dots",iconOnly:!0,label:t("Toolbar.more")})}),l=n("17x9"),p=n.n(l),f=n("l0Ix"),d=function(e){var t=e.from,n=e.embedInCozyBar,r=void 0!==n&&n,a=e.t,c=e.size,s=e.className;return o.a.createElement(i.b,{label:a("Share.create-cozy"),icon:"cozy-negative",className:r?u.a["bar-homelink"]:s,href:Object(f.a)(t),size:c})};d.propTypes={from:p.a.string,embedInCozyBar:p.a.bool,t:p.a.func.isRequired,size:p.a.oneOf(["tiny","small","large","normal"])},d.defaultProps={from:"",size:"normal"};var m=d;n.d(t,"b",function(){return s}),n.d(t,"a",function(){return m})},SvWF:function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("buk/"),i=n("GoJ1"),c=n("KXWi"),u=n("4BeY"),s=n.n(u),l=n("IaFt"),p=n.n(l),f=new s.a({id:"icon-image-broken_a4fd70a7dc9c96a1d21491390660382c",use:"icon-image-broken_a4fd70a7dc9c96a1d21491390660382c-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="icon-image-broken_a4fd70a7dc9c96a1d21491390660382c">\n  <g fill="none" fill-rule="evenodd" transform="translate(0 2)">\n    <rect width="32" height="28" fill="#FDD5D5" rx="2" />\n    <path fill="#F52D2D" d="M24,20 L13,15 L19.2902805,8.70971949 C19.6822478,8.31775224 20.3203148,8.32031476 20.7062149,8.7062149 L29,17 L24,20 Z" />\n    <path fill="#F52D2D" d="M0,22 L6.29028051,15.7097195 C6.68224776,15.3177522 7.31387329,15.3138733 7.70591205,15.7059121 L11,19 L15.0233154,14.9766846 L24,19 L27.2486572,17.2486572 L32,22 L32,26.0020869 C32,27.1055038 31.1107383,28 29.9982567,28 L2.00174332,28 C0.89621101,28 0,27.1017394 0,26.0020869 L0,22 Z" />\n    <circle cx="8" cy="7" r="3" fill="#FFFFFF" />\n    <path stroke="#FDD5D5" d="M11,18.3000031 L5.5,23.8000031 L11,18.3000031 Z" stroke-linecap="round" stroke-linejoin="round" />\n    <polyline stroke="#FFFFFF" stroke-width="2" points="0 17 8 13 24 20 32 16" stroke-linecap="round" stroke-linejoin="round" />\n  </g>\n</symbol>'}),d=(p.a.add(f),f);n.d(t,"b",function(){return h});var m=Object(a.c)()(function(e){var t=e.t,n=e.errorType;return o.a.createElement(i.a,{title:t("Error.".concat(n,"_title")),icon:d},o.a.createElement(c.a,{onClick:function(){return window.location.reload()},label:t("Error.refresh")}))}),h=function(e,t,n){return function(r){return e(r)?o.a.createElement(m,{errorType:t}):o.a.createElement(n,r)}};t.a=m},Te91:function(e,t,n){e.exports={"coz-btn-shared":"coz-btn-shared--27aW9","coz-btn-sharedWithMe":"coz-btn-sharedWithMe--1CdsF"}},TtgU:function(e,t,n){"use strict";var r=n("kKu1"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("CMvH"),u=n("buk/"),s=n("sIaW"),l=n.n(s),p=n("TSYQ"),f=n.n(p),d=n("dtw8"),m=n("510Z");var h=Object(d.f)(function(e){var t,n,r,a=e.photo,c=e.box,u=e.selected,s=void 0!==u&&u,l=e.onToggle,p=e.router,h=function(e){var t={};return e&&(e.width&&(t.width="".concat(e.width,"px")),e.height&&(t.height="".concat(e.height,"px")),e.top&&(t.top="".concat(e.top,"px")),e.left&&(t.left="".concat(e.left,"px"))),t}(c);return i.a.createElement("div",{style:h,"data-test-item":a.name,className:f()(o.a["pho-photo"],(t={},n=o.a["pho-photo--selected"],r=s,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))},i.a.createElement("div",null,i.a.createElement("span",{className:o.a["pho-photo-select"],"data-input":"checkbox",onClick:function(e){e.stopPropagation(),l(a,s)}},i.a.createElement("input",{type:"checkbox",checked:s,onChange:function(){}}),i.a.createElement("label",null)),i.a.createElement(d.a,{to:{pathname:"".concat(p.location.pathname,"/").concat(a.id),query:p.location.query}},i.a.createElement(m.a,{file:a,size:"small",render:function(e){return i.a.createElement("img",{"data-test-id":"pho-photo-item",src:e,className:o.a["pho-photo-item"],style:h})}}))))});function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _={width:1,height:1},O=function(e){return 180+(e||1800)/30},E=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,g(t).apply(this,arguments))}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,a["Component"]),n=t,(r=[{key:"isPhotoSelected",value:function(e,t){return-1!==t.map(function(e){return e._id}).indexOf(e._id)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.key,a=t.title,c=t.photos,u=t.selected,s=t.showSelection,p=t.onPhotoToggle,d=t.onPhotosSelect,m=t.onPhotosUnselect,b=t.containerWidth;if(!b)return null;var y=b>=768?{spacing:16,padding:32}:{spacing:8,padding:0},v=l()(c.map(function(e){var t=e.metadata||e.attributes.metadata;return t&&t.width&&t.height?function(e){return e.orientation&&e.orientation>4?{width:e.height,height:e.width}:e}(t):_}),{containerWidth:b,targetRowHeight:O(b),boxSpacing:{horizontal:y.spacing,vertical:y.spacing},containerPadding:{top:0,right:y.padding,bottom:0,left:y.padding}}),g=u.map(function(e){return e._id}),w=c.every(function(e){return-1!==g.indexOf(e._id)}),E=v.boxes[0].top,k=v.boxes.findIndex(function(e){return e.top!==E}),j=-1===k?v.boxes[v.boxes.length-1]:v.boxes[k-1],S=b-j.left-j.width-y.padding;return i.a.createElement("div",{"data-test-id":"photo-section",className:f()(o.a["pho-section"],s&&o.a["pho-section--has-selection"]),key:r,style:{width:"".concat(b,"px")}},i.a.createElement("div",{className:o.a["pho-section-header"]},i.a.createElement("h3",null,a),s&&c.length>1&&w&&i.a.createElement("a",{style:{marginRight:"".concat(S,"px")},onClick:function(){return m(c)}},n("Board.unselect_all")),s&&c.length>1&&!w&&i.a.createElement("a",{style:{marginRight:"".concat(S,"px")},onClick:function(){return d(c)}},n("Board.select_all"))),i.a.createElement("div",{className:o.a["pho-photo-wrapper"],style:{width:"".concat(b,"px"),height:"".concat(v.containerHeight,"px")}},c.map(function(t,n){return i.a.createElement(h,{photo:t,box:v.boxes[n],key:t.id,selected:e.isPhotoSelected(t,u),onToggle:p})})))}}])&&y(n.prototype,r),c&&y(n,c),t}(),k=Object(u.c)()(E),j=n("KOJc"),S=n("ZFPb"),x=n("SvWF"),P=n("RPnM");function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var z=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,R(t).apply(this,arguments))}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,a["Component"]),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.t,n=e.f,r=e.lists,a=e.selected,c=e.photosContext,u=e.showSelection,s=e.onPhotoToggle,l=e.onPhotosSelect,p=e.onPhotosUnselect,f=e.fetchStatus,d=e.hasMore,m=e.fetchMore,h=e.measureRef,b=e.contentRect.entry.width,y="pending"===f||"loading"===f;return"failed"===f?i.a.createElement(x.a,{errorType:"".concat(c,"_photos")}):y?i.a.createElement(S.a,{loadingType:"photos_fetching"}):y||0!==r.length&&0!==r[0].photos.length?i.a.createElement("div",{className:u?o.a["pho-list-selection"]:"",ref:h},r.map(function(e,t){return i.a.createElement(k,{key:t,title:e.title||(e.month?n(e.month,"MMMM YYYY"):""),photos:e.photos,selected:a,showSelection:u,onPhotoToggle:s,onPhotosSelect:l,onPhotosUnselect:p,containerWidth:b})}),d&&i.a.createElement(P.a,{label:t("Board.load_more"),width:b,onClick:m})):i.a.createElement(j.a,{localeKey:"".concat(c,"_photos")})}}])&&A(n.prototype,r),c&&A(n,c),t}();t.a=Object(u.c)()(Object(c.a)()(z))},VZRP:function(e,t,n){e.exports={"pho-content-title":"pho-content-title--3Yt9z",error:"error--2qbV5","pho-content-header":"pho-content-header--1M4IS","--hide-bar":"_--hide-bar--lrytb","pho-content-album-previous":"pho-content-album-previous--3BqBh",spin:"spin--1ZeSG",shake:"shake--3WZrZ"}},"XA+M":function(e,t){e.exports={name:"Drive",name_prefix:"Cozy",slug:"drive",version:"1.18.9",type:"webapp",licence:"AGPL-3.0",icon:"public/app-icon.svg",categories:["cozy"],source:"https://github.com/cozy/cozy-drive",editor:"Cozy",developer:{name:"Cozy Cloud",url:"https://cozy.io"},locales:{en:{short_description:"Cozy Drive helps you to save, sync and secure your files on your Cozy.",long_description:"With Cozy Drive, you can easily:\n- Store your important files and keep them secure in your Cozy\n- Access to all your documents online & offline, from your desktop, and on your smartphone or tablet\n- Share links to files ans folders with who you like;\n- Automatically retrieve bills, payrolls, tax notices and other data from your main online services (internet, energy, retail, mobile, energy, travel...)\n- Upload files to your Cozy from your Android",screenshots:["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png","screenshots/en/screenshot03.png","screenshots/en/screenshot04.png"]},fr:{short_description:"Cozy Drive est lâapplication de sauvegarde, de synchronisation et de sÃ©curisation de tous vos fichiers sur Cozy.",long_description:"Avec Cozy Drive vous pourrez :\n- Sauvegarder et synchroniser gratuitement tous vos documents importants (carte dâidentitÃ©, photos de vacances, avis dâimposition, fiches de salairesâ¦);\n- AccÃ©der Ã  vos documents nâimporte quand, nâimporte ou mÃªme en mode avion depuis votre bureau, votre smartphone ou tablette;\n- Partager vos fichiers et dossiers par lien avec qui vous le souhaitez;\n- RÃ©cupÃ©rer automatiquement vos documents administratifs de vos principaux fournisseurs de service (opÃ©rateur mobile, fournisseur dâÃ©nergie, assureur, internet, santÃ©â¦);\n- Rester synchronisÃ©Â·e lors de vos voyages et dÃ©placements professionnels avec nos applications mobiles.",screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png","screenshots/fr/screenshot03.png","screenshots/fr/screenshot04.png"]}},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png","screenshots/fr/screenshot03.png","screenshots/fr/screenshot04.png"],langs:["en","fr"],platforms:[{type:"ios",url:"https://itunes.apple.com/us/app/cozy-drive/id1224102389?mt=8"},{type:"android",url:"https://play.google.com/store/apps/details?id=io.cozy.drive.mobile"}],routes:{"/":{folder:"/",index:"index.html",public:!1},"/intents":{folder:"/intents",index:"index.html",public:!1},"/public":{folder:"/public",index:"index.html",public:!0},"/preview":{folder:"/public",index:"index.html",public:!0}},intents:[{action:"OPEN",type:["io.cozy.files"],href:"/intents"},{action:"PICK",type:["io.cozy.files"],href:"/intents"},{action:"GET_URL",type:["io.cozy.files"],href:"/intents"},{action:"OPEN",type:["io.cozy.suggestions"],href:"/intents"}],permissions:{files:{description:"Required to access the files",type:"io.cozy.files",verbs:["ALL"]},apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},albums:{description:"Required to manage photos albums",type:"io.cozy.photos.albums",verbs:["PUT"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},oauth:{description:"Required to display the cozy-desktop banner",type:"io.cozy.oauth.clients",verbs:["GET"]},reporting:{description:"Allow to report unexpected errors to the support team",type:"cc.cozycloud.sentry",verbs:["POST"]},mail:{description:"Send feedback emails to the support team",type:"io.cozy.jobs",verbs:["POST"],selector:"worker",values:["sendmail"]}}}},Yo2A:function(e,t,n){"use strict";var r=n("fvjX"),o=n("q1tI"),a=n.n(o),i=n("/MKj");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{show:!1,component:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SHOW_MODAL":return{show:!0,component:t.component};case"HIDE_MODAL":return{show:!1,component:null};default:return e}},s=function(e){return{type:"SHOW_MODAL",component:e,meta:{hideActionMenu:!0}}},l=Object(i.connect)(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},e.ui.modal)})(function(e){var t=e.show,n=e.component,r=e.dispatch;return t?a.a.cloneElement(n,{onClose:function(e){return r(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:"HIDE_MODAL",meta:e}}(e))}}):null});function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=p(t,2),r=n[0],o=n[1],a=void 0===o||o;return e[r]=a,e},d=function(){return window.location.search.substring(1).split("&").map(function(e){return e.split("=")}).reduce(f,{})},m=n("17x9"),h=n.n(m);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,g(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,a.a.Component),n=t,(r=[{key:"getChildContext",value:function(){return this.props}},{key:"render",value:function(){return this.props.children?Array.isArray(this.props.children)?this.props.children[0]:this.props.children:null}}])&&y(n.prototype,r),o&&y(n,o),t}();_.childContextTypes={client:h.a.object.isRequired,t:h.a.func.isRequired,store:h.a.object.isRequired,children:h.a.object};n.d(t,"a",function(){return l}),n.d(t,"d",function(){return s}),n.d(t,"c",function(){return d});t.b=Object(r.combineReducers)({modal:u})},ZFPb:function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("TSYQ"),i=n.n(a),c=n("buk/"),u=n("V2U0"),s=n("7jrE"),l=n.n(s),p=n("5ZYL"),f=n.n(p);t.a=Object(c.c)()(function(e){var t=e.size,n=void 0===t?"xxlarge":t,r=e.loadingType,a=e.noMargin,c=void 0!==a&&a,s=e.middle,p=void 0===s||s;return o.a.createElement("div",{"data-test-id":"loading",className:i()(f.a["pho-loading"])},o.a.createElement(u.b,{size:n,loadingType:r,color:l.a.dodgerBlue,noMargin:c,middle:p}))})},cwrA:function(e,t,n){"use strict";var r=n("q1tI"),o=n.n(r),a=n("dtw8"),i=n("B9Y0"),c=n("mD6m");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){var t=e.location.pathname;return t.substring(0,t.lastIndexOf("/"))},m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,p(t).apply(this,arguments))}var n,a,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,r["Component"]),n=t,(a=[{key:"render",value:function(){var e=this.props,t=e.photos,n=e.params,r=e.router,a=t.findIndex(function(e){return e.id===n.photoId});return o.a.createElement(i.a,null,o.a.createElement(c.a,{files:t,currentIndex:a,onChangeRequest:function(e){return r.push({pathname:"".concat(d(r),"/").concat(e.id),query:r.location.query})},onCloseRequest:function(){return r.push({pathname:d(r),query:r.location.query})}}))}}])&&s(n.prototype,a),u&&s(n,u),t}();t.a=Object(a.f)(m)},eKCf:function(e,t,n){"use strict";var r=n("VZRP"),o=n.n(r),a=n("q1tI"),i=n.n(a),c=n("buk/"),u=n("ufaa"),s=n("dtw8"),l=n("17x9"),p=n.n(l),f=n("56YH"),d=n.n(f);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?w(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=cozy.bar,j=k.BarCenter,S=k.BarRight,x=k.BarLeft,P=13,C=27,A=function(e){function t(e){var n;return h(this,t),E(w(n=v(this,g(t).call(this,e))),"handleBlur",function(e){!n.ignoreBlurEvent&&n.props.onEdit&&n.props.onEdit(""!==e.target.value.trim()?e.target.value:n.props.albumName)}),E(w(n),"handleKeyDown",function(e){e.keyCode===P&&n.props.onEdit?(n.ignoreBlurEvent=!0,n.props.onEdit(e.target.value)):e.keyCode===C&&n.props.onEdit&&(n.ignoreBlurEvent=!0,n.props.onEdit(n.props.albumName))}),n.ignoreBlurEvent=!1,n.inputElement=null,n}return _(t,a["Component"]),y(t,[{key:"componentDidMount",value:function(){null!==this.inputElement&&(this.inputElement.focus(),this.inputElement.select())}},{key:"render",value:function(){var e=this,t=this.props.albumName;return i.a.createElement("input",{type:"text",defaultValue:t,onKeyDown:this.handleKeyDown,onBlur:this.handleBlur,ref:function(t){e.inputElement=t}})}}]),t}();A.propTypes={albumName:p.a.string,onEdit:p.a.func.isRequired};var T=function(e){var t=e.children;return i.a.createElement("h2",{"data-test-id":"pho-content-title",className:o.a["pho-content-title"]},t)},R=function(e){var t=e.onClick;return i.a.createElement("div",{role:"button","data-test-id":"pho-content-album-previous",className:o.a["pho-content-album-previous"],onClick:t})};R.propTypes={onClick:p.a.func.isRequired};var N=function(e){function t(){return h(this,t),v(this,g(t).apply(this,arguments))}return _(t,a["Component"]),y(t,[{key:"componentDidMount",value:function(){var e=this.props.router.location.pathname;this.parentUrl=e.substring(0,e.lastIndexOf("/"))}},{key:"renderTitle",value:function(){var e=this.props,t=e.t,n=e.viewName,r=e.albumName,o=void 0===r?"":r,a=e.onEdit,c=e.editing;return"albumContent"===n?void 0!==c&&c?i.a.createElement(A,{albumName:o,onEdit:a}):o:t("Nav.".concat(n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.viewName,a=t.breakpoints.isMobile,c=t.router,u="albumContent"===r,s=i.a.createElement(T,null,this.renderTitle()),l=a?i.a.createElement(j,null,s):s,p=a?i.a.createElement(S,null,n):n,f=i.a.createElement(R,{onClick:function(){return c.push(e.parentUrl)}}),d=a?i.a.createElement(x,null,f):f;return i.a.createElement("div",{className:o.a["pho-content-header"]},u&&d,l,p)}}]),t}();N.propTypes={viewName:p.a.string.isRequired,albumName:p.a.string,t:p.a.func.isRequired,editing:p.a.bool,onEdit:p.a.func,breakpoints:p.a.object.isRequired,router:p.a.object.isRequired,children:p.a.node},N.defaultProps={editing:!1,onEdit:function(){}},t.a=d()(s.f,Object(u.a)(),Object(c.c)())(N)},fWVu:function(e,t,n){e.exports={container:"container--3-RCo",suggestionsContainer:"suggestionsContainer--3lRrx",suggestionsContainerOpen:"suggestionsContainerOpen--3Y523",input:"input--2DlOl",suggestionsList:"suggestionsList--35tTI",suggestion:"suggestion--iMlMu",suggestionHighlighted:"suggestionHighlighted--3v0My",recipientsContainer:"recipientsContainer--1GWdl",recipientChip:"recipientChip--1HV-h",removeRecipient:"removeRecipient--2dtVM"}},jrFr:function(e,t,n){e.exports={"share-modal-content":"share-modal-content--1SlxN","coz-form":"coz-form--2jtJC","coz-form-group":"coz-form-group--1bFva","coz-form-desc":"coz-form-desc--JrEED","coz-form-label":"coz-form-label--3Zm6p","coz-form-label--error":"coz-form-label--error--2KzmX","coz-form-errors":"coz-form-errors--1nNWc","coz-form-controls":"coz-form-controls--1RJGg","coz-form-controls--full":"coz-form-controls--full--2-y4G","coz-form-controls--dispatch":"coz-form-controls--dispatch--2TjNA",error:"error--3q85L","permission-required-popin":"permission-required-popin--3ZT7U",divider:"divider--3ACWO","share-bylink-header":"share-bylink-header--2919D","share-bylink-header-dot":"share-bylink-header-dot--1TAFX","share-bylink-header-creating":"share-bylink-header-creating--2F2Df","share-bylink-header-copybtn":"share-bylink-header-copybtn--397lg","share-bylink-desc":"share-bylink-desc--2lsfE","share-byemail-onlybylink":"share-byemail-onlybylink--3A-9J","share-moral-override-bottom":"share-moral-override-bottom--1I3dU","share-modal-secondary":"share-modal-secondary--3Y04a","share-modal-margins":"share-modal-margins--yhQBn","share-modal-separator":"share-modal-separator--JJuRH","share-type-control":"share-type-control--3IS3y","select-wrapper":"select-wrapper--3vfxZ","select-option":"select-option--O5o86","select-option-label":"select-option-label--314tl","select-option-desc":"select-option-desc--1JNRs","input-dual":"input-dual--1iSDa","btn-copy":"btn-copy--1_EQX","permission-required-popin-close":"permission-required-popin-close--wbc77","permission-required-popin-accept":"permission-required-popin-accept--3gyRJ","share-details-created":"share-details-created--3qeE6","share-details-perm":"share-details-perm--1bWoi","share-details-perm-desc":"share-details-perm-desc--2uJr3",spin:"spin--260Kl",shake:"shake--2b0j3"}},kKu1:function(e,t,n){e.exports={"pho-section":"pho-section--aOGQ8","pho-photo-wrapper":"pho-photo-wrapper--34Af_","pho-section-header":"pho-section-header--3xCwP","pho-photo":"pho-photo--1RccV","pho-photo-item":"pho-photo-item--1uvPt","pho-photo-select":"pho-photo-select--2_YlY","pho-photo--selected":"pho-photo--selected--3CHFZ","pho-section--has-selection":"pho-section--has-selection--2A-rj","pho-list-morebutton":"pho-list-morebutton--1HHd8",spin:"spin--3HNuy",shake:"shake--p49Dg"}},l0Ix:function(e,t,n){"use strict";t.a=function(e){return"https://manager.cozycloud.cc/cozy/create".concat(e?"?pk_campaign=".concat(encodeURIComponent(e)):"?","&pk_kwd=cozy")}},lEMr:function(e,t,n){e.exports={"upload-queue":"upload-queue--2RXFj","upload-queue--visible":"upload-queue--visible--frmGj","upload-queue-header":"upload-queue-header--Vz871","upload-queue-header-inner":"upload-queue-header-inner--1AQpy","btn-close":"btn-close--32K_q","upload-queue-progress":"upload-queue-progress--2O2Rw","upload-queue-content":"upload-queue-content--UNBUz","upload-queue--collapsed":"upload-queue--collapsed--nIVVP","upload-queue-list":"upload-queue-list--2dzTR","upload-queue-item--error":"upload-queue-item--error--3UNkr","upload-queue-item--done":"upload-queue-item--done--23Ps1","upload-queue-item":"upload-queue-item--2oTRx","item-cell":"item-cell--1mZJx","item-file":"item-file--24emt","item-ext":"item-ext--3vgYK","item-image":"item-image--wp0ZG","item-status":"item-status--2Azg6","item-pending":"item-pending--wp4pw",spin:"spin--3291m",shake:"shake--eSk8B"}},luXY:function(e,t,n){e.exports={"pho-create-album-form":"pho-create-album-form--xgUhP",error:"error--2VcpR","coz-create-album-label":"coz-create-album-label--2zpY4","coz-inline-form":"coz-inline-form--3COco","coz-input-text":"coz-input-text--ZuuYG","create-button":"create-button--1cJgR",spin:"spin--1T4Vk",shake:"shake--3cnvd"}},nw0P:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"kOWh","./ar/build_distance_in_words_locale/index.js":"XxX6","./ar/build_format_locale/index.js":"alis","./ar/index.js":"EDRf","./be/build_distance_in_words_locale/index.js":"LQ09","./be/build_format_locale/index.js":"kj7F","./be/index.js":"YEhR","./bg/build_distance_in_words_locale/index.js":"7K3h","./bg/build_format_locale/index.js":"RrdL","./bg/index.js":"isx8","./ca/build_distance_in_words_locale/index.js":"wqqj","./ca/build_format_locale/index.js":"qcV0","./ca/index.js":"Vwa+","./cs/build_distance_in_words_locale/index.js":"ZKDM","./cs/build_format_locale/index.js":"ipyF","./cs/index.js":"dvhP","./da/build_distance_in_words_locale/index.js":"2Mgc","./da/build_format_locale/index.js":"Gned","./da/index.js":"7ur/","./de/build_distance_in_words_locale/index.js":"5IWf","./de/build_format_locale/index.js":"THCn","./de/index.js":"bgw5","./el/build_distance_in_words_locale/index.js":"o/GB","./el/build_format_locale/index.js":"8T9h","./el/index.js":"dH0v","./en/build_distance_in_words_locale/index.js":"LZbM","./en/build_format_locale/index.js":"6DAA","./en/index.js":"Us+F","./eo/build_distance_in_words_locale/index.js":"qrnn","./eo/build_format_locale/index.js":"Bl15","./eo/index.js":"UB7v","./es/build_distance_in_words_locale/index.js":"GEfZ","./es/build_format_locale/index.js":"O+zC","./es/index.js":"/S0t","./fi/build_distance_in_words_locale/index.js":"VHtQ","./fi/build_format_locale/index.js":"Oydx","./fi/index.js":"ndVD","./fil/build_distance_in_words_locale/index.js":"uq4p","./fil/build_format_locale/index.js":"d7hw","./fil/index.js":"pNfm","./fr/build_distance_in_words_locale/index.js":"IzMR","./fr/build_format_locale/index.js":"I3Zg","./fr/index.js":"LKA2","./hr/build_distance_in_words_locale/index.js":"DPvn","./hr/build_format_locale/index.js":"puw3","./hr/index.js":"L9Jq","./hu/build_distance_in_words_locale/index.js":"w2RQ","./hu/build_format_locale/index.js":"/0iD","./hu/index.js":"Nm+E","./id/build_distance_in_words_locale/index.js":"JbvB","./id/build_format_locale/index.js":"0wlw","./id/index.js":"A6C3","./is/build_distance_in_words_locale/index.js":"qzMC","./is/build_format_locale/index.js":"S3yD","./is/index.js":"N4bE","./it/build_distance_in_words_locale/index.js":"MDEp","./it/build_format_locale/index.js":"aUJd","./it/index.js":"hmb4","./ja/build_distance_in_words_locale/index.js":"nNvt","./ja/build_format_locale/index.js":"buui","./ja/index.js":"uAXs","./ko/build_distance_in_words_locale/index.js":"oEw+","./ko/build_format_locale/index.js":"9SQf","./ko/index.js":"iW8+","./mk/build_distance_in_words_locale/index.js":"nmwZ","./mk/build_format_locale/index.js":"htxJ","./mk/index.js":"GzBU","./nb/build_distance_in_words_locale/index.js":"SL1f","./nb/build_format_locale/index.js":"CJ5F","./nb/index.js":"73vv","./nl/build_distance_in_words_locale/index.js":"Uyu0","./nl/build_format_locale/index.js":"doCD","./nl/index.js":"hCQt","./pl/build_distance_in_words_locale/index.js":"FUBD","./pl/build_format_locale/index.js":"nOYf","./pl/index.js":"B6yL","./pt/build_distance_in_words_locale/index.js":"aTPA","./pt/build_format_locale/index.js":"TTT0","./pt/index.js":"gdks","./ro/build_distance_in_words_locale/index.js":"gI+A","./ro/build_format_locale/index.js":"njjO","./ro/index.js":"r2yp","./ru/build_distance_in_words_locale/index.js":"KmPx","./ru/build_format_locale/index.js":"UUBw","./ru/index.js":"nz/o","./sk/build_distance_in_words_locale/index.js":"q2Bs","./sk/build_format_locale/index.js":"9sxn","./sk/index.js":"Wqan","./sl/build_distance_in_words_locale/index.js":"mlv2","./sl/build_format_locale/index.js":"vHkZ","./sl/index.js":"KYSo","./sr/build_distance_in_words_locale/index.js":"LlkS","./sr/build_format_locale/index.js":"RhjJ","./sr/index.js":"7mU3","./sv/build_distance_in_words_locale/index.js":"UNBN","./sv/build_format_locale/index.js":"zTNB","./sv/index.js":"hxgj","./th/build_distance_in_words_locale/index.js":"XAGa","./th/build_format_locale/index.js":"We2s","./th/index.js":"Pk+z","./tr/build_distance_in_words_locale/index.js":"aFZF","./tr/build_format_locale/index.js":"jh7A","./tr/index.js":"3ZWG","./zh_cn/build_distance_in_words_locale/index.js":"KdB7","./zh_cn/build_format_locale/index.js":"l4EP","./zh_cn/index.js":"8tMq","./zh_tw/build_distance_in_words_locale/index.js":"vyyr","./zh_tw/build_format_locale/index.js":"uYH7","./zh_tw/index.js":"QPlQ"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="nw0P"},oGE2:function(e,t,n){"use strict";n.r(t);n("/8/d"),n("59mS");var r=n("q1tI"),o=n.n(r),a=n("i8i4"),i=n("fvjX"),c=n("sINF"),u=n("1mXj"),s=n("dtw8"),l=n("SH7X"),p=n.n(l),f=n("buk/"),d=n("KHOr"),m=n("Yo2A"),h={upload:d.c,ui:m.b},b=n("0yyf"),y=n.n(b),v=n("jDpt"),g=n("9VR2"),w=n("fSd/"),_=n("o0o1"),O=n.n(_),E=n("AzIT"),k=n.n(E),j=n("oAJy"),S=n.n(j),x=n("4kcP");function P(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}var C=function(e){var t=Object(x.b)();t&&t.push(["trackEvent","interaction","desktop-prompt",e])},A=function(){return window.navigator&&-1===window.navigator.appVersion.indexOf("Win")&&-1===window.navigator.appVersion.indexOf("Mac")},T=function(){var e,t=(e=O.a.mark(function e(){var t;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cozy.client.fetchJSON("GET","/settings/clients");case 2:return t=e.sent,e.abrupt("return",t.some(function(e){return"github.com/cozy-labs/cozy-desktop"===e.attributes.software_id}));case 4:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){P(a,r,o,i,c,"next",e)}function c(e){P(a,r,o,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}(),R=n("FKqX"),N=n("y6ex"),z=n("dq/4");function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){U(e,t,n[t])})}return e}function q(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var G=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,n=!(o=(e=M(t)).call.apply(e,[this].concat(i)))||"object"!==L(o)&&"function"!=typeof o?B(r):o,U(B(n),"state",{mustShow:!1}),n}var n,a,i,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentWillMount",value:(c=O.a.mark(function e(){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===R.promoteDesktop.isActivated){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,S.a.getItem("desktop_banner");case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=!1;case 7:if(!e.t0){e.next=13;break}return e.next=11,T();case 11:!e.sent&&this.setState(function(e){return D({},e,{mustShow:!0})});case 13:case"end":return e.stop()}},e,this)}),u=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=c.apply(e,t);function a(e){q(o,n,r,a,i,"next",e)}function i(e){q(o,n,r,a,i,"throw",e)}a(void 0)})},function(){return u.apply(this,arguments)})},{key:"render",value:function(){if(!0!==R.promoteDesktop.isActivated||!this.state.mustShow)return null;var e=this.props.t;return o.a.createElement("a",{href:e(A()?"Nav.link-client":"Nav.link-client-desktop"),target:"_blank",className:k.a["coz-btn-client"],onClick:function(){C("button")}},o.a.createElement("figure",null,o.a.createElement(N.a,{width:"32",height:"32",icon:z.a})),o.a.createElement("span",null,e("Nav.btn-client")))}}])&&I(n.prototype,a),i&&I(n,i),t}(),V=Object(f.c)()(G),H=n("KXWi");function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function t(e){var n,r,o,a,i,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=!(o=Z(t).call(this,e))||"object"!==Y(o)&&"function"!=typeof o?Q(r):o,a=Q(n),c={mustShow:!1},(i="state")in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,n.willUnmount=!1,n}var n,a,i,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(t,r["Component"]),n=t,(a=[{key:"componentDidMount",value:(c=O.a.mark(function e(){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.willUnmount=!1,e.next=3,S.a.getItem("desktop_banner");case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=!1;case 6:if(e.t0){e.next=12;break}return e.next=10,T();case 10:!e.sent&&!this.willUnmount&&this.setState({mustShow:!0});case 12:case"end":return e.stop()}},e,this)}),u=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=c.apply(e,t);function a(e){K(o,n,r,a,i,"next",e)}function i(e){K(o,n,r,a,i,"throw",e)}a(void 0)})},function(){return u.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.willUnmount=!0}},{key:"markAsSeen",value:function(e){S.a.setItem("desktop_banner",!0),this.setState({mustShow:!1}),C(e)}},{key:"render",value:function(){var e=this;if(!0!==R.promoteDesktop.isActivated||!this.state.mustShow)return null;var t=this.props.t,n=window.navigator.userAgent&&/iPad|iPhone|iPod/.test(window.navigator.userAgent)?"Nav.link-client-ios":window.navigator.userAgent&&window.navigator.userAgent.indexOf("Android")>=0?"Nav.link-client-android":"Nav.link-client",r=A()?"Nav.link-client":"Nav.link-client-desktop";return o.a.createElement("div",{className:k.a["coz-banner-client"]},o.a.createElement(H.b,{href:t(n),target:"_blank",className:k.a["coz-btn-clientMobile"],onClick:function(){e.markAsSeen("banner")},label:t("Nav.btn-client-mobile")}),o.a.createElement("div",{className:k.a["coz-banner-text"]},o.a.createElement("figure",null,o.a.createElement(N.a,{icon:"cozy",width:"44",height:"44"})),o.a.createElement("span",null,t("Nav.banner-txt-client")),o.a.createElement(H.b,{href:t(r),target:"_blank",theme:"alpha",onClick:function(){e.markAsSeen("banner")},label:t("Nav.banner-btn-client")})),o.a.createElement(H.a,{theme:"close",extension:"narrow",className:k.a["close-banner"],onClick:function(){e.markAsSeen("close")},icon:o.a.createElement(N.a,{icon:"cross",width:"24",height:"24"}),iconOnly:!0,label:t("SelectionBar.close")}))}}])&&W(n.prototype,a),i&&W(n,i),t}(),$=Object(f.c)()(J),ee=n("67rm"),te=n("le8I"),ne=Object(w.e)(s.a),re=Object(f.c)()(function(e){var t=e.t,n=e.children;return o.a.createElement(v.b,null,o.a.createElement(g.a,{className:y.a["pho-sidebar"]},o.a.createElement(w.d,null,o.a.createElement(w.b,null,o.a.createElement(ne,{to:"/photos"},o.a.createElement(w.a,{icon:"image"}),o.a.createElement(w.c,null,t("Nav.photos")))),o.a.createElement(w.b,{"data-test-id":"nav-to-albums"},o.a.createElement(ne,{to:"/albums"},o.a.createElement(w.a,{icon:"album"}),o.a.createElement(w.c,null,t("Nav.albums"))))),o.a.createElement(V,null)),o.a.createElement(ee.a,{t:t}),o.a.createElement(d.a,null),o.a.createElement(v.c,{className:y.a["pho-content"]},o.a.createElement($,null),n),o.a.createElement(te.a,null))}),oe=n("2lpW"),ae=n("SRpc"),ie=n("cwrA"),ce=o.a.createElement(s.c,{component:re},o.a.createElement(s.c,{path:"photos",component:oe.b},o.a.createElement(s.c,{path:":photoId",component:ie.a})),o.a.createElement(s.c,{path:"albums",component:ae.d},o.a.createElement(s.c,{path:"new",component:ae.e}),o.a.createElement(s.c,{path:":albumId",component:ae.c},o.a.createElement(s.c,{path:"edit",component:ae.e}),o.a.createElement(s.c,{path:":photoId",component:ie.a}))),o.a.createElement(s.b,{from:"/*",to:"photos"})),ue=n("qxHO"),se=n("yZiV"),le=n("NqoY");function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fe=Object(u.createLogger)();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[role=application]"),t=e.dataset,r=document.documentElement.getAttribute("lang")||"en",u=window.location?window.location.protocol:"https:",d="".concat(u,"//").concat(t.cozyDomain),m=new p.a({uri:d,token:t.cozyToken,appMetadata:se.a,schema:le.a});cozy.client.init({cozyURL:d,token:t.cozyToken}),cozy.bar.init({appName:t.cozyAppName,appEditor:t.cozyAppEditor,cozyClient:m,iconPath:t.cozyIconPath,lang:t.cozyLocale,replaceTitleOnMobile:!0}),Object(ue.a)(),Object(ue.b)(d);var b=s.e,y=[c.default,fe];if(Object(x.c)()&&Object(x.b)()){var v=Object(x.b)();b=v.connectToHistory(s.e),v.track(s.e.getCurrentLocation()),y.push(Object(x.a)())}var g=i.compose,w=Object(i.createStore)(Object(i.combineReducers)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){pe(e,t,n[t])})}return e}({},h,{cozy:m.reducer()})),g(i.applyMiddleware.apply(void 0,y)));Object(a.render)(o.a.createElement(f.b,{lang:r,dictRequire:function(e){return n("Gofk")("./".concat(e))}},o.a.createElement(l.CozyProvider,{store:w,client:m},o.a.createElement(s.d,{history:b,routes:ce}))),e)})},"q/Uw":function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r=n("q1tI"),o=n.n(r),a=n("+MCZ");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d=o.a.createContext([]),m=function(){return{type:"SHOW_SELECTION_BAR"}},h=function(){return{type:"HIDE_SELECTION_BAR"}},b=function(e,t){return{type:t?"UNSELECT_ITEM":"SELECT_ITEM",item:e}},y=function(e){return{type:"ADD_TO_SELECTION",items:e}},v=function(e){return{type:"REMOVE_FROM_SELECTION",items:e}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return[];switch(t.type){case"SELECT_ITEM":return[].concat(f(e),[t.item]);case"UNSELECT_ITEM":return e.filter(function(e){return e._id!==t.item.id});case"ADD_TO_SELECTION":var n=e.map(function(e){return e._id}),r=t.items.filter(function(e){return-1===n.indexOf(e._id)});return[].concat(f(e),f(r));case"REMOVE_FROM_SELECTION":var o=t.items.map(function(e){return e._id});return e.filter(function(e){return-1===o.indexOf(e._id)});case"HIDE_SELECTION_BAR":return[];default:return e}},w=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.cancelSelection)return!1;switch(t.type){case"TOGGLE_SELECTION_BAR":return!e;case"SHOW_SELECTION_BAR":return!0;case"HIDE_SELECTION_BAR":return!1;default:return e}},_=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return r=this,o=(e=u(t)).call.apply(e,[this].concat(c)),n=!o||"object"!==i(o)&&"function"!=typeof o?s(r):o,p(s(n),"state",{selected:g(void 0,{}),opened:w(void 0,{})}),p(s(n),"toggle",function(e,t){return n.dispatch(b(e,t))}),p(s(n),"select",function(e){return n.dispatch(y(e))}),p(s(n),"unselect",function(e){return n.dispatch(v(e))}),p(s(n),"clear",function(){return n.dispatch(h())}),p(s(n),"show",function(){return n.dispatch(m())}),n}var n,f,_;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r["Component"]),n=t,(f=[{key:"dispatch",value:function(e){this.setState(function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}({},t,{selected:g(t.selected,e),opened:w(t.opened,e)})})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.actions,r=void 0===n?{}:n,i=this.state,c=i.selected,u=i.opened,s=0!==c.length||u,l={toggle:this.toggle,select:this.select,unselect:this.unselect,clear:this.clear,show:this.show},p="function"==typeof r?r(l):r,f={};Object.keys(p).map(function(e){f[e]="function"==typeof p[e]?{action:p[e]}:p[e]});var m=Object.keys(f).length>0;return o.a.createElement(d.Provider,{value:c},o.a.createElement("div",null,s&&m&&o.a.createElement(a.a,{selected:c,hideSelectionBar:this.clear,actions:f}),t(c,s,l)))}}])&&c(n.prototype,f),_&&c(n,_),t}();d.Consumer},qxHO:function(e,t,n){"use strict";var r=n("NlKi"),o=n.n(r),a=n("XA+M"),i=n.n(a),c={slug:i.a.name,version:i.a.version};n("OTOu");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return f}),n.d(t,"b",function(){return d});var s="undefined"==typeof __SENTRY_URL__?"":__SENTRY_URL__,l=function(e,t){return e.replace(/^file:\/\//,"app://").replace(t,"")},p=function(e){var t=/^.*\/[^.]+(\.app|CodePush|.*(?=\/))/;e.culprit&&(e.culprit=l(e.culprit,t));var n=e.stacktrace||e.exception&&e.exception.values&&e.exception.values[0]&&e.exception.values[0].stacktrace;return n&&(n.frames=n.frames.map(function(e){return"[native code]"!==e.filename?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}({},e,{filename:l(e.filename,t)}):e})),e},f=function(){o.a.config(s,{shouldSendCallback:!0,environment:"production",release:c.version,allowSecretKey:!0,dataCallback:p}).install()},d=function(e){o.a.setTagsContext({instance:e})}},swni:function(e,t,n){e.exports={"u-visuallyhidden":"u-visuallyhidden--1L4hk","dri-btn--more":"dri-btn--more--MNdqs","bar-homelink":"bar-homelink--2j0WN"}},t0Aa:function(e,t,n){e.exports={"u-hide--mob":"u-hide--mob--1U-px","u-hide--tablet":"u-hide--tablet--2T9Ct","u-hide--desk":"u-hide--desk--2FZ80","c-btn":"c-btn--1VDiR","c-btn--regular":"c-btn--regular--1AoRN","c-btn--danger":"c-btn--danger--2NNcc","c-btn--secondary":"c-btn--secondary--3znY5","c-btn--danger-outline":"c-btn--danger-outline--mVde8","pho-toolbar":"pho-toolbar--28WqL","pho-action-delete":"pho-action-delete--3RnOf","pho-action-upload":"pho-action-upload--1QgoA",spin:"spin--GHUiz",shake:"shake--3TZHV"}},u0ID:function(e,t){e.exports={name:"Photos",name_prefix:"Cozy",slug:"photos",version:"1.18.9",type:"webapp",licence:"AGPL-3.0",icon:"public/app-icon.svg",categories:["cozy"],source:"https://github.com/cozy/cozy-drive",editor:"Cozy",developer:{name:"Cozy Cloud",url:"https://cozy.io"},langs:["en","fr"],locales:{fr:{short_description:"Cozy Photos est lâapplication de visualisation et gestion de vos photos sur Cozy.",long_description:"Avec Cozy Photos vous pourrez :\n- Visualiser toutes les photos prÃ©sentes dans votre Cozy, classÃ©es par date;\n- Organisez vos photos en albums;\n- Partager vos albums avec qui vous le souhaitez.",screenshots:["screenshots/fr/screenshot01.jpg","screenshots/fr/screenshot02.jpg","screenshots/fr/screenshot03.jpg"]},en:{short_description:"Cozy Photos allows you to view and manage your photos on your Cozy",long_description:"With Cozy Photos, you can:\n- Get a timeline of all your memories\n- Organize your photos through albums\n- Share albums with just a link",screenshots:["screenshots/en/screenshot01.jpg","screenshots/en/screenshot02.jpg","screenshots/en/screenshot03.jpg"]}},screenshots:["screenshots/fr/screenshot01.jpg","screenshots/fr/screenshot02.jpg","screenshots/fr/screenshot03.jpg"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/public",index:"index.html",public:!0}},services:{onPhotoUpload:{type:"node",file:"services/onPhotoUpload/photos.js",trigger:"@event io.cozy.files:CREATED:image:class",debounce:"5m"}},permissions:{files:{description:"Required for photo access",type:"io.cozy.files",verbs:["GET","POST","PUT","PATCH"]},apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET","PUT"]},albums:{description:"Required to manage photos albums",type:"io.cozy.photos.albums",verbs:["GET","POST","PUT","DELETE"]},photos_settings:{description:"Required to manage photos albums settings",type:"io.cozy.photos.settings",verbs:["GET","POST","PUT"]},contacts:{description:"Required to to share photos with your contacts",type:"io.cozy.contacts",verbs:["GET","POST"]},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},oauth:{description:"Required to display the cozy-desktop banner",type:"io.cozy.oauth.clients",verbs:["GET"]},reporting:{description:"Allow to report unexpected errors to the support team",type:"cc.cozycloud.sentry",verbs:["POST"]},triggers:{description:"Required to re-execute the clustering",type:"io.cozy.triggers",verbs:["POST"],selector:"worker",values:["service"]}}}},yZiV:function(e,t,n){"use strict";var r=n("u0ID"),o=n.n(r),a={slug:o.a.name,version:o.a.version};t.a=a},z6Q1:function(e,t,n){"use strict";var r=n("OjRq");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return c});var a="io.cozy.files",i="io.cozy.photos.albums",c="io.cozy.apps";!function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}}({files:{doctype:a},contacts:{doctype:r.a.doctype,doctypeVersion:2},groups:{doctype:r.c.doctype}},{})}});